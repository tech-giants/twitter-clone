{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst Generator = require(\"../Generator\");\n\nconst WebAssemblyExportImportedDependency = require(\"../dependencies/WebAssemblyExportImportedDependency\");\n\nconst WebAssemblyImportDependency = require(\"../dependencies/WebAssemblyImportDependency\");\n\nconst WebAssemblyInInitialChunkError = require(\"./WebAssemblyInInitialChunkError\");\n/** @typedef {import(\"../Compiler\")} Compiler */\n\n\nlet WebAssemblyGenerator;\nlet WebAssemblyJavascriptGenerator;\nlet WebAssemblyParser;\n\nclass WebAssemblyModulesPlugin {\n  constructor(options) {\n    this.options = options;\n  }\n  /**\n   * @param {Compiler} compiler compiler\n   * @returns {void}\n   */\n\n\n  apply(compiler) {\n    compiler.hooks.compilation.tap(\"WebAssemblyModulesPlugin\", (compilation, {\n      normalModuleFactory\n    }) => {\n      compilation.dependencyFactories.set(WebAssemblyImportDependency, normalModuleFactory);\n      compilation.dependencyFactories.set(WebAssemblyExportImportedDependency, normalModuleFactory);\n      normalModuleFactory.hooks.createParser.for(\"webassembly/experimental\").tap(\"WebAssemblyModulesPlugin\", () => {\n        if (WebAssemblyParser === undefined) {\n          WebAssemblyParser = require(\"./WebAssemblyParser\");\n        }\n\n        return new WebAssemblyParser();\n      });\n      normalModuleFactory.hooks.createGenerator.for(\"webassembly/experimental\").tap(\"WebAssemblyModulesPlugin\", () => {\n        if (WebAssemblyGenerator === undefined) {\n          WebAssemblyGenerator = require(\"./WebAssemblyGenerator\");\n        }\n\n        if (WebAssemblyJavascriptGenerator === undefined) {\n          WebAssemblyJavascriptGenerator = require(\"./WebAssemblyJavascriptGenerator\");\n        }\n\n        return Generator.byType({\n          javascript: new WebAssemblyJavascriptGenerator(),\n          webassembly: new WebAssemblyGenerator(this.options)\n        });\n      });\n      compilation.chunkTemplate.hooks.renderManifest.tap(\"WebAssemblyModulesPlugin\", (result, options) => {\n        const chunk = options.chunk;\n        const outputOptions = options.outputOptions;\n        const moduleTemplates = options.moduleTemplates;\n        const dependencyTemplates = options.dependencyTemplates;\n\n        for (const module of chunk.modulesIterable) {\n          if (module.type && module.type.startsWith(\"webassembly\")) {\n            const filenameTemplate = outputOptions.webassemblyModuleFilename;\n            result.push({\n              render: () => this.renderWebAssembly(module, moduleTemplates.webassembly, dependencyTemplates),\n              filenameTemplate,\n              pathOptions: {\n                module\n              },\n              identifier: `webassemblyModule${module.id}`,\n              hash: module.hash\n            });\n          }\n        }\n\n        return result;\n      });\n      compilation.hooks.afterChunks.tap(\"WebAssemblyModulesPlugin\", () => {\n        const initialWasmModules = new Set();\n\n        for (const chunk of compilation.chunks) {\n          if (chunk.canBeInitial()) {\n            for (const module of chunk.modulesIterable) {\n              if (module.type.startsWith(\"webassembly\")) {\n                initialWasmModules.add(module);\n              }\n            }\n          }\n        }\n\n        for (const module of initialWasmModules) {\n          compilation.errors.push(new WebAssemblyInInitialChunkError(module, compilation.requestShortener));\n        }\n      });\n    });\n  }\n\n  renderWebAssembly(module, moduleTemplate, dependencyTemplates) {\n    return moduleTemplate.render(module, dependencyTemplates, {});\n  }\n\n}\n\nmodule.exports = WebAssemblyModulesPlugin;","map":{"version":3,"sources":["/Users/hamzakhan/Documents/twitter-react/twitter/node_modules/webpack/lib/wasm/WebAssemblyModulesPlugin.js"],"names":["Generator","require","WebAssemblyExportImportedDependency","WebAssemblyImportDependency","WebAssemblyInInitialChunkError","WebAssemblyGenerator","WebAssemblyJavascriptGenerator","WebAssemblyParser","WebAssemblyModulesPlugin","constructor","options","apply","compiler","hooks","compilation","tap","normalModuleFactory","dependencyFactories","set","createParser","for","undefined","createGenerator","byType","javascript","webassembly","chunkTemplate","renderManifest","result","chunk","outputOptions","moduleTemplates","dependencyTemplates","module","modulesIterable","type","startsWith","filenameTemplate","webassemblyModuleFilename","push","render","renderWebAssembly","pathOptions","identifier","id","hash","afterChunks","initialWasmModules","Set","chunks","canBeInitial","add","errors","requestShortener","moduleTemplate","exports"],"mappings":"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","sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst Generator = require(\"../Generator\");\nconst WebAssemblyExportImportedDependency = require(\"../dependencies/WebAssemblyExportImportedDependency\");\nconst WebAssemblyImportDependency = require(\"../dependencies/WebAssemblyImportDependency\");\nconst WebAssemblyInInitialChunkError = require(\"./WebAssemblyInInitialChunkError\");\n\n/** @typedef {import(\"../Compiler\")} Compiler */\n\nlet WebAssemblyGenerator;\nlet WebAssemblyJavascriptGenerator;\nlet WebAssemblyParser;\n\nclass WebAssemblyModulesPlugin {\n\tconstructor(options) {\n\t\tthis.options = options;\n\t}\n\n\t/**\n\t * @param {Compiler} compiler compiler\n\t * @returns {void}\n\t */\n\tapply(compiler) {\n\t\tcompiler.hooks.compilation.tap(\n\t\t\t\"WebAssemblyModulesPlugin\",\n\t\t\t(compilation, { normalModuleFactory }) => {\n\t\t\t\tcompilation.dependencyFactories.set(\n\t\t\t\t\tWebAssemblyImportDependency,\n\t\t\t\t\tnormalModuleFactory\n\t\t\t\t);\n\n\t\t\t\tcompilation.dependencyFactories.set(\n\t\t\t\t\tWebAssemblyExportImportedDependency,\n\t\t\t\t\tnormalModuleFactory\n\t\t\t\t);\n\n\t\t\t\tnormalModuleFactory.hooks.createParser\n\t\t\t\t\t.for(\"webassembly/experimental\")\n\t\t\t\t\t.tap(\"WebAssemblyModulesPlugin\", () => {\n\t\t\t\t\t\tif (WebAssemblyParser === undefined) {\n\t\t\t\t\t\t\tWebAssemblyParser = require(\"./WebAssemblyParser\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn new WebAssemblyParser();\n\t\t\t\t\t});\n\n\t\t\t\tnormalModuleFactory.hooks.createGenerator\n\t\t\t\t\t.for(\"webassembly/experimental\")\n\t\t\t\t\t.tap(\"WebAssemblyModulesPlugin\", () => {\n\t\t\t\t\t\tif (WebAssemblyGenerator === undefined) {\n\t\t\t\t\t\t\tWebAssemblyGenerator = require(\"./WebAssemblyGenerator\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (WebAssemblyJavascriptGenerator === undefined) {\n\t\t\t\t\t\t\tWebAssemblyJavascriptGenerator = require(\"./WebAssemblyJavascriptGenerator\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn Generator.byType({\n\t\t\t\t\t\t\tjavascript: new WebAssemblyJavascriptGenerator(),\n\t\t\t\t\t\t\twebassembly: new WebAssemblyGenerator(this.options)\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\tcompilation.chunkTemplate.hooks.renderManifest.tap(\n\t\t\t\t\t\"WebAssemblyModulesPlugin\",\n\t\t\t\t\t(result, options) => {\n\t\t\t\t\t\tconst chunk = options.chunk;\n\t\t\t\t\t\tconst outputOptions = options.outputOptions;\n\t\t\t\t\t\tconst moduleTemplates = options.moduleTemplates;\n\t\t\t\t\t\tconst dependencyTemplates = options.dependencyTemplates;\n\n\t\t\t\t\t\tfor (const module of chunk.modulesIterable) {\n\t\t\t\t\t\t\tif (module.type && module.type.startsWith(\"webassembly\")) {\n\t\t\t\t\t\t\t\tconst filenameTemplate =\n\t\t\t\t\t\t\t\t\toutputOptions.webassemblyModuleFilename;\n\n\t\t\t\t\t\t\t\tresult.push({\n\t\t\t\t\t\t\t\t\trender: () =>\n\t\t\t\t\t\t\t\t\t\tthis.renderWebAssembly(\n\t\t\t\t\t\t\t\t\t\t\tmodule,\n\t\t\t\t\t\t\t\t\t\t\tmoduleTemplates.webassembly,\n\t\t\t\t\t\t\t\t\t\t\tdependencyTemplates\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\tfilenameTemplate,\n\t\t\t\t\t\t\t\t\tpathOptions: {\n\t\t\t\t\t\t\t\t\t\tmodule\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tidentifier: `webassemblyModule${module.id}`,\n\t\t\t\t\t\t\t\t\thash: module.hash\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tcompilation.hooks.afterChunks.tap(\"WebAssemblyModulesPlugin\", () => {\n\t\t\t\t\tconst initialWasmModules = new Set();\n\t\t\t\t\tfor (const chunk of compilation.chunks) {\n\t\t\t\t\t\tif (chunk.canBeInitial()) {\n\t\t\t\t\t\t\tfor (const module of chunk.modulesIterable) {\n\t\t\t\t\t\t\t\tif (module.type.startsWith(\"webassembly\")) {\n\t\t\t\t\t\t\t\t\tinitialWasmModules.add(module);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor (const module of initialWasmModules) {\n\t\t\t\t\t\tcompilation.errors.push(\n\t\t\t\t\t\t\tnew WebAssemblyInInitialChunkError(\n\t\t\t\t\t\t\t\tmodule,\n\t\t\t\t\t\t\t\tcompilation.requestShortener\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t}\n\n\trenderWebAssembly(module, moduleTemplate, dependencyTemplates) {\n\t\treturn moduleTemplate.render(module, dependencyTemplates, {});\n\t}\n}\n\nmodule.exports = WebAssemblyModulesPlugin;\n"]},"metadata":{},"sourceType":"script"}