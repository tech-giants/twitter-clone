{"ast":null,"code":"/*\n MIT License http://www.opensource.org/licenses/mit-license.php\n Author Joel Denning @joeldenning\n */\n\"use strict\";\n\nconst {\n  ConcatSource\n} = require(\"webpack-sources\");\n\nconst Template = require(\"./Template\");\n/** @typedef {import(\"./Compilation\")} Compilation */\n\n/**\n * @typedef {Object} SystemMainTemplatePluginOptions\n * @param {string=} name the library name\n */\n\n\nclass SystemMainTemplatePlugin {\n  /**\n   * @param {SystemMainTemplatePluginOptions} options the plugin options\n   */\n  constructor(options) {\n    this.name = options.name;\n  }\n  /**\n   * @param {Compilation} compilation the compilation instance\n   * @returns {void}\n   */\n\n\n  apply(compilation) {\n    const {\n      mainTemplate,\n      chunkTemplate\n    } = compilation;\n\n    const onRenderWithEntry = (source, chunk, hash) => {\n      const externals = chunk.getModules().filter(m => m.external); // The name this bundle should be registered as with System\n\n      const name = this.name ? `${JSON.stringify(mainTemplate.getAssetPath(this.name, {\n        hash,\n        chunk\n      }))}, ` : \"\"; // The array of dependencies that are external to webpack and will be provided by System\n\n      const systemDependencies = JSON.stringify(externals.map(m => typeof m.request === \"object\" ? m.request.amd : m.request)); // The name of the variable provided by System for exporting\n\n      const dynamicExport = \"__WEBPACK_DYNAMIC_EXPORT__\"; // An array of the internal variable names for the webpack externals\n\n      const externalWebpackNames = externals.map(m => `__WEBPACK_EXTERNAL_MODULE_${Template.toIdentifier(`${m.id}`)}__`); // Declaring variables for the internal variable names for the webpack externals\n\n      const externalVarDeclarations = externalWebpackNames.length > 0 ? `var ${externalWebpackNames.join(\", \")};` : \"\"; // The system.register format requires an array of setter functions for externals.\n\n      const setters = externalWebpackNames.length === 0 ? \"\" : Template.asString([\"setters: [\", Template.indent(externalWebpackNames.map(external => Template.asString([\"function(module) {\", Template.indent(`${external} = module;`), \"}\"])).join(\",\\n\")), \"],\"]);\n      return new ConcatSource(Template.asString([`System.register(${name}${systemDependencies}, function(${dynamicExport}) {`, Template.indent([externalVarDeclarations, \"return {\", Template.indent([setters, \"execute: function() {\", Template.indent(`${dynamicExport}(`)])])]) + \"\\n\", source, \"\\n\" + Template.asString([Template.indent([Template.indent([Template.indent([\");\"]), \"}\"]), \"};\"]), \"})\"]));\n    };\n\n    for (const template of [mainTemplate, chunkTemplate]) {\n      template.hooks.renderWithEntry.tap(\"SystemMainTemplatePlugin\", onRenderWithEntry);\n    }\n\n    mainTemplate.hooks.globalHashPaths.tap(\"SystemMainTemplatePlugin\", paths => {\n      if (this.name) {\n        paths.push(this.name);\n      }\n\n      return paths;\n    });\n    mainTemplate.hooks.hash.tap(\"SystemMainTemplatePlugin\", hash => {\n      hash.update(\"exports system\");\n\n      if (this.name) {\n        hash.update(this.name);\n      }\n    });\n  }\n\n}\n\nmodule.exports = SystemMainTemplatePlugin;","map":{"version":3,"sources":["/Users/hamzakhan/Documents/twitter-react/twitter/node_modules/webpack/lib/SystemMainTemplatePlugin.js"],"names":["ConcatSource","require","Template","SystemMainTemplatePlugin","constructor","options","name","apply","compilation","mainTemplate","chunkTemplate","onRenderWithEntry","source","chunk","hash","externals","getModules","filter","m","external","JSON","stringify","getAssetPath","systemDependencies","map","request","amd","dynamicExport","externalWebpackNames","toIdentifier","id","externalVarDeclarations","length","join","setters","asString","indent","template","hooks","renderWithEntry","tap","globalHashPaths","paths","push","update","module","exports"],"mappings":"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","sourcesContent":["/*\n MIT License http://www.opensource.org/licenses/mit-license.php\n Author Joel Denning @joeldenning\n */\n\n\"use strict\";\n\nconst { ConcatSource } = require(\"webpack-sources\");\nconst Template = require(\"./Template\");\n\n/** @typedef {import(\"./Compilation\")} Compilation */\n\n/**\n * @typedef {Object} SystemMainTemplatePluginOptions\n * @param {string=} name the library name\n */\n\nclass SystemMainTemplatePlugin {\n\t/**\n\t * @param {SystemMainTemplatePluginOptions} options the plugin options\n\t */\n\tconstructor(options) {\n\t\tthis.name = options.name;\n\t}\n\n\t/**\n\t * @param {Compilation} compilation the compilation instance\n\t * @returns {void}\n\t */\n\tapply(compilation) {\n\t\tconst { mainTemplate, chunkTemplate } = compilation;\n\n\t\tconst onRenderWithEntry = (source, chunk, hash) => {\n\t\t\tconst externals = chunk.getModules().filter(m => m.external);\n\n\t\t\t// The name this bundle should be registered as with System\n\t\t\tconst name = this.name\n\t\t\t\t? `${JSON.stringify(\n\t\t\t\t\t\tmainTemplate.getAssetPath(this.name, { hash, chunk })\n\t\t\t\t  )}, `\n\t\t\t\t: \"\";\n\n\t\t\t// The array of dependencies that are external to webpack and will be provided by System\n\t\t\tconst systemDependencies = JSON.stringify(\n\t\t\t\texternals.map(m =>\n\t\t\t\t\ttypeof m.request === \"object\" ? m.request.amd : m.request\n\t\t\t\t)\n\t\t\t);\n\n\t\t\t// The name of the variable provided by System for exporting\n\t\t\tconst dynamicExport = \"__WEBPACK_DYNAMIC_EXPORT__\";\n\n\t\t\t// An array of the internal variable names for the webpack externals\n\t\t\tconst externalWebpackNames = externals.map(\n\t\t\t\tm => `__WEBPACK_EXTERNAL_MODULE_${Template.toIdentifier(`${m.id}`)}__`\n\t\t\t);\n\n\t\t\t// Declaring variables for the internal variable names for the webpack externals\n\t\t\tconst externalVarDeclarations =\n\t\t\t\texternalWebpackNames.length > 0\n\t\t\t\t\t? `var ${externalWebpackNames.join(\", \")};`\n\t\t\t\t\t: \"\";\n\n\t\t\t// The system.register format requires an array of setter functions for externals.\n\t\t\tconst setters =\n\t\t\t\texternalWebpackNames.length === 0\n\t\t\t\t\t? \"\"\n\t\t\t\t\t: Template.asString([\n\t\t\t\t\t\t\t\"setters: [\",\n\t\t\t\t\t\t\tTemplate.indent(\n\t\t\t\t\t\t\t\texternalWebpackNames\n\t\t\t\t\t\t\t\t\t.map(external =>\n\t\t\t\t\t\t\t\t\t\tTemplate.asString([\n\t\t\t\t\t\t\t\t\t\t\t\"function(module) {\",\n\t\t\t\t\t\t\t\t\t\t\tTemplate.indent(`${external} = module;`),\n\t\t\t\t\t\t\t\t\t\t\t\"}\"\n\t\t\t\t\t\t\t\t\t\t])\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t.join(\",\\n\")\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\"],\"\n\t\t\t\t\t  ]);\n\n\t\t\treturn new ConcatSource(\n\t\t\t\tTemplate.asString([\n\t\t\t\t\t`System.register(${name}${systemDependencies}, function(${dynamicExport}) {`,\n\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\texternalVarDeclarations,\n\t\t\t\t\t\t\"return {\",\n\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\tsetters,\n\t\t\t\t\t\t\t\"execute: function() {\",\n\t\t\t\t\t\t\tTemplate.indent(`${dynamicExport}(`)\n\t\t\t\t\t\t])\n\t\t\t\t\t])\n\t\t\t\t]) + \"\\n\",\n\t\t\t\tsource,\n\t\t\t\t\"\\n\" +\n\t\t\t\t\tTemplate.asString([\n\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\tTemplate.indent([Template.indent([\");\"]), \"}\"]),\n\t\t\t\t\t\t\t\"};\"\n\t\t\t\t\t\t]),\n\t\t\t\t\t\t\"})\"\n\t\t\t\t\t])\n\t\t\t);\n\t\t};\n\n\t\tfor (const template of [mainTemplate, chunkTemplate]) {\n\t\t\ttemplate.hooks.renderWithEntry.tap(\n\t\t\t\t\"SystemMainTemplatePlugin\",\n\t\t\t\tonRenderWithEntry\n\t\t\t);\n\t\t}\n\n\t\tmainTemplate.hooks.globalHashPaths.tap(\n\t\t\t\"SystemMainTemplatePlugin\",\n\t\t\tpaths => {\n\t\t\t\tif (this.name) {\n\t\t\t\t\tpaths.push(this.name);\n\t\t\t\t}\n\t\t\t\treturn paths;\n\t\t\t}\n\t\t);\n\n\t\tmainTemplate.hooks.hash.tap(\"SystemMainTemplatePlugin\", hash => {\n\t\t\thash.update(\"exports system\");\n\t\t\tif (this.name) {\n\t\t\t\thash.update(this.name);\n\t\t\t}\n\t\t});\n\t}\n}\n\nmodule.exports = SystemMainTemplatePlugin;\n"]},"metadata":{},"sourceType":"script"}