{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst {\n  SyncWaterfallHook\n} = require(\"tapable\");\n\nconst Template = require(\"../Template\");\n\nclass JsonpMainTemplatePlugin {\n  apply(mainTemplate) {\n    const needChunkOnDemandLoadingCode = chunk => {\n      for (const chunkGroup of chunk.groupsIterable) {\n        if (chunkGroup.getNumberOfChildren() > 0) return true;\n      }\n\n      return false;\n    };\n\n    const needChunkLoadingCode = chunk => {\n      for (const chunkGroup of chunk.groupsIterable) {\n        if (chunkGroup.chunks.length > 1) return true;\n        if (chunkGroup.getNumberOfChildren() > 0) return true;\n      }\n\n      return false;\n    };\n\n    const needEntryDeferringCode = chunk => {\n      for (const chunkGroup of chunk.groupsIterable) {\n        if (chunkGroup.chunks.length > 1) return true;\n      }\n\n      return false;\n    };\n\n    const needPrefetchingCode = chunk => {\n      const allPrefetchChunks = chunk.getChildIdsByOrdersMap(true).prefetch;\n      return allPrefetchChunks && Object.keys(allPrefetchChunks).length;\n    }; // TODO webpack 5, no adding to .hooks, use WeakMap and static methods\n\n\n    [\"jsonpScript\", \"linkPreload\", \"linkPrefetch\"].forEach(hook => {\n      if (!mainTemplate.hooks[hook]) {\n        mainTemplate.hooks[hook] = new SyncWaterfallHook([\"source\", \"chunk\", \"hash\"]);\n      }\n    });\n\n    const getScriptSrcPath = (hash, chunk, chunkIdExpression) => {\n      const chunkFilename = mainTemplate.outputOptions.chunkFilename;\n      const chunkMaps = chunk.getChunkMaps();\n      return mainTemplate.getAssetPath(JSON.stringify(chunkFilename), {\n        hash: `\" + ${mainTemplate.renderCurrentHashCode(hash)} + \"`,\n        hashWithLength: length => `\" + ${mainTemplate.renderCurrentHashCode(hash, length)} + \"`,\n        chunk: {\n          id: `\" + ${chunkIdExpression} + \"`,\n          hash: `\" + ${JSON.stringify(chunkMaps.hash)}[${chunkIdExpression}] + \"`,\n\n          hashWithLength(length) {\n            const shortChunkHashMap = Object.create(null);\n\n            for (const chunkId of Object.keys(chunkMaps.hash)) {\n              if (typeof chunkMaps.hash[chunkId] === \"string\") {\n                shortChunkHashMap[chunkId] = chunkMaps.hash[chunkId].substr(0, length);\n              }\n            }\n\n            return `\" + ${JSON.stringify(shortChunkHashMap)}[${chunkIdExpression}] + \"`;\n          },\n\n          name: `\" + (${JSON.stringify(chunkMaps.name)}[${chunkIdExpression}]||${chunkIdExpression}) + \"`,\n          contentHash: {\n            javascript: `\" + ${JSON.stringify(chunkMaps.contentHash.javascript)}[${chunkIdExpression}] + \"`\n          },\n          contentHashWithLength: {\n            javascript: length => {\n              const shortContentHashMap = {};\n              const contentHash = chunkMaps.contentHash.javascript;\n\n              for (const chunkId of Object.keys(contentHash)) {\n                if (typeof contentHash[chunkId] === \"string\") {\n                  shortContentHashMap[chunkId] = contentHash[chunkId].substr(0, length);\n                }\n              }\n\n              return `\" + ${JSON.stringify(shortContentHashMap)}[${chunkIdExpression}] + \"`;\n            }\n          }\n        },\n        contentHashType: \"javascript\"\n      });\n    };\n\n    mainTemplate.hooks.localVars.tap(\"JsonpMainTemplatePlugin\", (source, chunk, hash) => {\n      const extraCode = [];\n\n      if (needChunkLoadingCode(chunk)) {\n        extraCode.push(\"\", \"// object to store loaded and loading chunks\", \"// undefined = chunk not loaded, null = chunk preloaded/prefetched\", \"// Promise = chunk loading, 0 = chunk loaded\", \"var installedChunks = {\", Template.indent(chunk.ids.map(id => `${JSON.stringify(id)}: 0`).join(\",\\n\")), \"};\", \"\", needEntryDeferringCode(chunk) ? needPrefetchingCode(chunk) ? \"var deferredModules = [], deferredPrefetch = [];\" : \"var deferredModules = [];\" : \"\");\n      }\n\n      if (needChunkOnDemandLoadingCode(chunk)) {\n        extraCode.push(\"\", \"// script path function\", \"function jsonpScriptSrc(chunkId) {\", Template.indent([`return ${mainTemplate.requireFn}.p + ${getScriptSrcPath(hash, chunk, \"chunkId\")}`]), \"}\");\n      }\n\n      if (extraCode.length === 0) return source;\n      return Template.asString([source, ...extraCode]);\n    });\n    mainTemplate.hooks.jsonpScript.tap(\"JsonpMainTemplatePlugin\", (_, chunk, hash) => {\n      const crossOriginLoading = mainTemplate.outputOptions.crossOriginLoading;\n      const chunkLoadTimeout = mainTemplate.outputOptions.chunkLoadTimeout;\n      const jsonpScriptType = mainTemplate.outputOptions.jsonpScriptType;\n      return Template.asString([\"var script = document.createElement('script');\", \"var onScriptComplete;\", jsonpScriptType ? `script.type = ${JSON.stringify(jsonpScriptType)};` : \"\", \"script.charset = 'utf-8';\", `script.timeout = ${chunkLoadTimeout / 1000};`, `if (${mainTemplate.requireFn}.nc) {`, Template.indent(`script.setAttribute(\"nonce\", ${mainTemplate.requireFn}.nc);`), \"}\", \"script.src = jsonpScriptSrc(chunkId);\", crossOriginLoading ? Template.asString([\"if (script.src.indexOf(window.location.origin + '/') !== 0) {\", Template.indent(`script.crossOrigin = ${JSON.stringify(crossOriginLoading)};`), \"}\"]) : \"\", \"// create error before stack unwound to get useful stacktrace later\", \"var error = new Error();\", \"onScriptComplete = function (event) {\", Template.indent([\"// avoid mem leaks in IE.\", \"script.onerror = script.onload = null;\", \"clearTimeout(timeout);\", \"var chunk = installedChunks[chunkId];\", \"if(chunk !== 0) {\", Template.indent([\"if(chunk) {\", Template.indent([\"var errorType = event && (event.type === 'load' ? 'missing' : event.type);\", \"var realSrc = event && event.target && event.target.src;\", \"error.message = 'Loading chunk ' + chunkId + ' failed.\\\\n(' + errorType + ': ' + realSrc + ')';\", \"error.name = 'ChunkLoadError';\", \"error.type = errorType;\", \"error.request = realSrc;\", \"chunk[1](error);\"]), \"}\", \"installedChunks[chunkId] = undefined;\"]), \"}\"]), \"};\", \"var timeout = setTimeout(function(){\", Template.indent([\"onScriptComplete({ type: 'timeout', target: script });\"]), `}, ${chunkLoadTimeout});`, \"script.onerror = script.onload = onScriptComplete;\"]);\n    });\n    mainTemplate.hooks.linkPreload.tap(\"JsonpMainTemplatePlugin\", (_, chunk, hash) => {\n      const crossOriginLoading = mainTemplate.outputOptions.crossOriginLoading;\n      const jsonpScriptType = mainTemplate.outputOptions.jsonpScriptType;\n      return Template.asString([\"var link = document.createElement('link');\", jsonpScriptType ? `link.type = ${JSON.stringify(jsonpScriptType)};` : \"\", \"link.charset = 'utf-8';\", `if (${mainTemplate.requireFn}.nc) {`, Template.indent(`link.setAttribute(\"nonce\", ${mainTemplate.requireFn}.nc);`), \"}\", 'link.rel = \"preload\";', 'link.as = \"script\";', \"link.href = jsonpScriptSrc(chunkId);\", crossOriginLoading ? Template.asString([\"if (link.href.indexOf(window.location.origin + '/') !== 0) {\", Template.indent(`link.crossOrigin = ${JSON.stringify(crossOriginLoading)};`), \"}\"]) : \"\"]);\n    });\n    mainTemplate.hooks.linkPrefetch.tap(\"JsonpMainTemplatePlugin\", (_, chunk, hash) => {\n      const crossOriginLoading = mainTemplate.outputOptions.crossOriginLoading;\n      return Template.asString([\"var link = document.createElement('link');\", crossOriginLoading ? `link.crossOrigin = ${JSON.stringify(crossOriginLoading)};` : \"\", `if (${mainTemplate.requireFn}.nc) {`, Template.indent(`link.setAttribute(\"nonce\", ${mainTemplate.requireFn}.nc);`), \"}\", 'link.rel = \"prefetch\";', 'link.as = \"script\";', \"link.href = jsonpScriptSrc(chunkId);\"]);\n    });\n    mainTemplate.hooks.requireEnsure.tap(\"JsonpMainTemplatePlugin load\", (source, chunk, hash) => {\n      return Template.asString([source, \"\", \"// JSONP chunk loading for javascript\", \"\", \"var installedChunkData = installedChunks[chunkId];\", 'if(installedChunkData !== 0) { // 0 means \"already installed\".', Template.indent([\"\", '// a Promise means \"currently loading\".', \"if(installedChunkData) {\", Template.indent([\"promises.push(installedChunkData[2]);\"]), \"} else {\", Template.indent([\"// setup Promise in chunk cache\", \"var promise = new Promise(function(resolve, reject) {\", Template.indent([\"installedChunkData = installedChunks[chunkId] = [resolve, reject];\"]), \"});\", \"promises.push(installedChunkData[2] = promise);\", \"\", \"// start chunk loading\", mainTemplate.hooks.jsonpScript.call(\"\", chunk, hash), \"document.head.appendChild(script);\"]), \"}\"]), \"}\"]);\n    });\n    mainTemplate.hooks.requireEnsure.tap({\n      name: \"JsonpMainTemplatePlugin preload\",\n      stage: 10\n    }, (source, chunk, hash) => {\n      const chunkMap = chunk.getChildIdsByOrdersMap().preload;\n      if (!chunkMap || Object.keys(chunkMap).length === 0) return source;\n      return Template.asString([source, \"\", \"// chunk preloadng for javascript\", \"\", `var chunkPreloadMap = ${JSON.stringify(chunkMap, null, \"\\t\")};`, \"\", \"var chunkPreloadData = chunkPreloadMap[chunkId];\", \"if(chunkPreloadData) {\", Template.indent([\"chunkPreloadData.forEach(function(chunkId) {\", Template.indent([\"if(installedChunks[chunkId] === undefined) {\", Template.indent([\"installedChunks[chunkId] = null;\", mainTemplate.hooks.linkPreload.call(\"\", chunk, hash), \"document.head.appendChild(link);\"]), \"}\"]), \"});\"]), \"}\"]);\n    });\n    mainTemplate.hooks.requireExtensions.tap(\"JsonpMainTemplatePlugin\", (source, chunk) => {\n      if (!needChunkOnDemandLoadingCode(chunk)) return source;\n      return Template.asString([source, \"\", \"// on error function for async loading\", `${mainTemplate.requireFn}.oe = function(err) { console.error(err); throw err; };`]);\n    });\n    mainTemplate.hooks.bootstrap.tap(\"JsonpMainTemplatePlugin\", (source, chunk, hash) => {\n      if (needChunkLoadingCode(chunk)) {\n        const withDefer = needEntryDeferringCode(chunk);\n        const withPrefetch = needPrefetchingCode(chunk);\n        return Template.asString([source, \"\", \"// install a JSONP callback for chunk loading\", \"function webpackJsonpCallback(data) {\", Template.indent([\"var chunkIds = data[0];\", \"var moreModules = data[1];\", withDefer ? \"var executeModules = data[2];\" : \"\", withPrefetch ? \"var prefetchChunks = data[3] || [];\" : \"\", '// add \"moreModules\" to the modules object,', '// then flag all \"chunkIds\" as loaded and fire callback', \"var moduleId, chunkId, i = 0, resolves = [];\", \"for(;i < chunkIds.length; i++) {\", Template.indent([\"chunkId = chunkIds[i];\", \"if(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\", Template.indent(\"resolves.push(installedChunks[chunkId][0]);\"), \"}\", \"installedChunks[chunkId] = 0;\"]), \"}\", \"for(moduleId in moreModules) {\", Template.indent([\"if(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\", Template.indent(mainTemplate.renderAddModule(hash, chunk, \"moduleId\", \"moreModules[moduleId]\")), \"}\"]), \"}\", \"if(parentJsonpFunction) parentJsonpFunction(data);\", withPrefetch ? withDefer ? \"deferredPrefetch.push.apply(deferredPrefetch, prefetchChunks);\" : Template.asString([\"// chunk prefetching for javascript\", \"prefetchChunks.forEach(function(chunkId) {\", Template.indent([\"if(installedChunks[chunkId] === undefined) {\", Template.indent([\"installedChunks[chunkId] = null;\", mainTemplate.hooks.linkPrefetch.call(\"\", chunk, hash), \"document.head.appendChild(link);\"]), \"}\"]), \"});\"]) : \"\", \"while(resolves.length) {\", Template.indent(\"resolves.shift()();\"), \"}\", withDefer ? Template.asString([\"\", \"// add entry modules from loaded chunk to deferred list\", \"deferredModules.push.apply(deferredModules, executeModules || []);\", \"\", \"// run deferred modules when all chunks ready\", \"return checkDeferredModules();\"]) : \"\"]), \"};\", withDefer ? Template.asString([\"function checkDeferredModules() {\", Template.indent([\"var result;\", \"for(var i = 0; i < deferredModules.length; i++) {\", Template.indent([\"var deferredModule = deferredModules[i];\", \"var fulfilled = true;\", \"for(var j = 1; j < deferredModule.length; j++) {\", Template.indent([\"var depId = deferredModule[j];\", \"if(installedChunks[depId] !== 0) fulfilled = false;\"]), \"}\", \"if(fulfilled) {\", Template.indent([\"deferredModules.splice(i--, 1);\", \"result = \" + mainTemplate.requireFn + \"(\" + mainTemplate.requireFn + \".s = deferredModule[0]);\"]), \"}\"]), \"}\", withPrefetch ? Template.asString([\"if(deferredModules.length === 0) {\", Template.indent([\"// chunk prefetching for javascript\", \"deferredPrefetch.forEach(function(chunkId) {\", Template.indent([\"if(installedChunks[chunkId] === undefined) {\", Template.indent([\"installedChunks[chunkId] = null;\", mainTemplate.hooks.linkPrefetch.call(\"\", chunk, hash), \"document.head.appendChild(link);\"]), \"}\"]), \"});\", \"deferredPrefetch.length = 0;\"]), \"}\"]) : \"\", \"return result;\"]), \"}\"]) : \"\"]);\n      }\n\n      return source;\n    });\n    mainTemplate.hooks.beforeStartup.tap(\"JsonpMainTemplatePlugin\", (source, chunk, hash) => {\n      if (needChunkLoadingCode(chunk)) {\n        var jsonpFunction = mainTemplate.outputOptions.jsonpFunction;\n        var globalObject = mainTemplate.outputOptions.globalObject;\n        return Template.asString([`var jsonpArray = ${globalObject}[${JSON.stringify(jsonpFunction)}] = ${globalObject}[${JSON.stringify(jsonpFunction)}] || [];`, \"var oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\", \"jsonpArray.push = webpackJsonpCallback;\", \"jsonpArray = jsonpArray.slice();\", \"for(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\", \"var parentJsonpFunction = oldJsonpFunction;\", \"\", source]);\n      }\n\n      return source;\n    });\n    mainTemplate.hooks.afterStartup.tap(\"JsonpMainTemplatePlugin\", (source, chunk, hash) => {\n      const prefetchChunks = chunk.getChildIdsByOrders().prefetch;\n\n      if (needChunkLoadingCode(chunk) && prefetchChunks && prefetchChunks.length) {\n        return Template.asString([source, `webpackJsonpCallback([[], {}, 0, ${JSON.stringify(prefetchChunks)}]);`]);\n      }\n\n      return source;\n    });\n    mainTemplate.hooks.startup.tap(\"JsonpMainTemplatePlugin\", (source, chunk, hash) => {\n      if (needEntryDeferringCode(chunk)) {\n        if (chunk.hasEntryModule()) {\n          const entries = [chunk.entryModule].filter(Boolean).map(m => [m.id].concat(Array.from(chunk.groupsIterable)[0].chunks.filter(c => c !== chunk).map(c => c.id)));\n          return Template.asString([\"// add entry module to deferred list\", `deferredModules.push(${entries.map(e => JSON.stringify(e)).join(\", \")});`, \"// run deferred modules when ready\", \"return checkDeferredModules();\"]);\n        } else {\n          return Template.asString([\"// run deferred modules from other chunks\", \"checkDeferredModules();\"]);\n        }\n      }\n\n      return source;\n    });\n    mainTemplate.hooks.hotBootstrap.tap(\"JsonpMainTemplatePlugin\", (source, chunk, hash) => {\n      const globalObject = mainTemplate.outputOptions.globalObject;\n      const hotUpdateChunkFilename = mainTemplate.outputOptions.hotUpdateChunkFilename;\n      const hotUpdateMainFilename = mainTemplate.outputOptions.hotUpdateMainFilename;\n      const crossOriginLoading = mainTemplate.outputOptions.crossOriginLoading;\n      const hotUpdateFunction = mainTemplate.outputOptions.hotUpdateFunction;\n      const currentHotUpdateChunkFilename = mainTemplate.getAssetPath(JSON.stringify(hotUpdateChunkFilename), {\n        hash: `\" + ${mainTemplate.renderCurrentHashCode(hash)} + \"`,\n        hashWithLength: length => `\" + ${mainTemplate.renderCurrentHashCode(hash, length)} + \"`,\n        chunk: {\n          id: '\" + chunkId + \"'\n        }\n      });\n      const currentHotUpdateMainFilename = mainTemplate.getAssetPath(JSON.stringify(hotUpdateMainFilename), {\n        hash: `\" + ${mainTemplate.renderCurrentHashCode(hash)} + \"`,\n        hashWithLength: length => `\" + ${mainTemplate.renderCurrentHashCode(hash, length)} + \"`\n      });\n      const runtimeSource = Template.getFunctionContent(require(\"./JsonpMainTemplate.runtime\")).replace(/\\/\\/\\$semicolon/g, \";\").replace(/\\$require\\$/g, mainTemplate.requireFn).replace(/\\$crossOriginLoading\\$/g, crossOriginLoading ? JSON.stringify(crossOriginLoading) : \"null\").replace(/\\$hotMainFilename\\$/g, currentHotUpdateMainFilename).replace(/\\$hotChunkFilename\\$/g, currentHotUpdateChunkFilename).replace(/\\$hash\\$/g, JSON.stringify(hash));\n      return `${source}\nfunction hotDisposeChunk(chunkId) {\n\tdelete installedChunks[chunkId];\n}\nvar parentHotUpdateCallback = ${globalObject}[${JSON.stringify(hotUpdateFunction)}];\n${globalObject}[${JSON.stringify(hotUpdateFunction)}] = ${runtimeSource}`;\n    });\n    mainTemplate.hooks.hash.tap(\"JsonpMainTemplatePlugin\", hash => {\n      hash.update(\"jsonp\");\n      hash.update(\"6\");\n    });\n  }\n\n}\n\nmodule.exports = JsonpMainTemplatePlugin;","map":{"version":3,"sources":["/Users/hamzakhan/Documents/twitter-react/twitter/node_modules/webpack/lib/web/JsonpMainTemplatePlugin.js"],"names":["SyncWaterfallHook","require","Template","JsonpMainTemplatePlugin","apply","mainTemplate","needChunkOnDemandLoadingCode","chunk","chunkGroup","groupsIterable","getNumberOfChildren","needChunkLoadingCode","chunks","length","needEntryDeferringCode","needPrefetchingCode","allPrefetchChunks","getChildIdsByOrdersMap","prefetch","Object","keys","forEach","hook","hooks","getScriptSrcPath","hash","chunkIdExpression","chunkFilename","outputOptions","chunkMaps","getChunkMaps","getAssetPath","JSON","stringify","renderCurrentHashCode","hashWithLength","id","shortChunkHashMap","create","chunkId","substr","name","contentHash","javascript","contentHashWithLength","shortContentHashMap","contentHashType","localVars","tap","source","extraCode","push","indent","ids","map","join","requireFn","asString","jsonpScript","_","crossOriginLoading","chunkLoadTimeout","jsonpScriptType","linkPreload","linkPrefetch","requireEnsure","call","stage","chunkMap","preload","requireExtensions","bootstrap","withDefer","withPrefetch","renderAddModule","beforeStartup","jsonpFunction","globalObject","afterStartup","prefetchChunks","getChildIdsByOrders","startup","hasEntryModule","entries","entryModule","filter","Boolean","m","concat","Array","from","c","e","hotBootstrap","hotUpdateChunkFilename","hotUpdateMainFilename","hotUpdateFunction","currentHotUpdateChunkFilename","currentHotUpdateMainFilename","runtimeSource","getFunctionContent","replace","update","module","exports"],"mappings":"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","sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst { SyncWaterfallHook } = require(\"tapable\");\nconst Template = require(\"../Template\");\n\nclass JsonpMainTemplatePlugin {\n\tapply(mainTemplate) {\n\t\tconst needChunkOnDemandLoadingCode = chunk => {\n\t\t\tfor (const chunkGroup of chunk.groupsIterable) {\n\t\t\t\tif (chunkGroup.getNumberOfChildren() > 0) return true;\n\t\t\t}\n\t\t\treturn false;\n\t\t};\n\t\tconst needChunkLoadingCode = chunk => {\n\t\t\tfor (const chunkGroup of chunk.groupsIterable) {\n\t\t\t\tif (chunkGroup.chunks.length > 1) return true;\n\t\t\t\tif (chunkGroup.getNumberOfChildren() > 0) return true;\n\t\t\t}\n\t\t\treturn false;\n\t\t};\n\t\tconst needEntryDeferringCode = chunk => {\n\t\t\tfor (const chunkGroup of chunk.groupsIterable) {\n\t\t\t\tif (chunkGroup.chunks.length > 1) return true;\n\t\t\t}\n\t\t\treturn false;\n\t\t};\n\t\tconst needPrefetchingCode = chunk => {\n\t\t\tconst allPrefetchChunks = chunk.getChildIdsByOrdersMap(true).prefetch;\n\t\t\treturn allPrefetchChunks && Object.keys(allPrefetchChunks).length;\n\t\t};\n\n\t\t// TODO webpack 5, no adding to .hooks, use WeakMap and static methods\n\t\t[\"jsonpScript\", \"linkPreload\", \"linkPrefetch\"].forEach(hook => {\n\t\t\tif (!mainTemplate.hooks[hook]) {\n\t\t\t\tmainTemplate.hooks[hook] = new SyncWaterfallHook([\n\t\t\t\t\t\"source\",\n\t\t\t\t\t\"chunk\",\n\t\t\t\t\t\"hash\"\n\t\t\t\t]);\n\t\t\t}\n\t\t});\n\n\t\tconst getScriptSrcPath = (hash, chunk, chunkIdExpression) => {\n\t\t\tconst chunkFilename = mainTemplate.outputOptions.chunkFilename;\n\t\t\tconst chunkMaps = chunk.getChunkMaps();\n\t\t\treturn mainTemplate.getAssetPath(JSON.stringify(chunkFilename), {\n\t\t\t\thash: `\" + ${mainTemplate.renderCurrentHashCode(hash)} + \"`,\n\t\t\t\thashWithLength: length =>\n\t\t\t\t\t`\" + ${mainTemplate.renderCurrentHashCode(hash, length)} + \"`,\n\t\t\t\tchunk: {\n\t\t\t\t\tid: `\" + ${chunkIdExpression} + \"`,\n\t\t\t\t\thash: `\" + ${JSON.stringify(\n\t\t\t\t\t\tchunkMaps.hash\n\t\t\t\t\t)}[${chunkIdExpression}] + \"`,\n\t\t\t\t\thashWithLength(length) {\n\t\t\t\t\t\tconst shortChunkHashMap = Object.create(null);\n\t\t\t\t\t\tfor (const chunkId of Object.keys(chunkMaps.hash)) {\n\t\t\t\t\t\t\tif (typeof chunkMaps.hash[chunkId] === \"string\") {\n\t\t\t\t\t\t\t\tshortChunkHashMap[chunkId] = chunkMaps.hash[chunkId].substr(\n\t\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\t\tlength\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn `\" + ${JSON.stringify(\n\t\t\t\t\t\t\tshortChunkHashMap\n\t\t\t\t\t\t)}[${chunkIdExpression}] + \"`;\n\t\t\t\t\t},\n\t\t\t\t\tname: `\" + (${JSON.stringify(\n\t\t\t\t\t\tchunkMaps.name\n\t\t\t\t\t)}[${chunkIdExpression}]||${chunkIdExpression}) + \"`,\n\t\t\t\t\tcontentHash: {\n\t\t\t\t\t\tjavascript: `\" + ${JSON.stringify(\n\t\t\t\t\t\t\tchunkMaps.contentHash.javascript\n\t\t\t\t\t\t)}[${chunkIdExpression}] + \"`\n\t\t\t\t\t},\n\t\t\t\t\tcontentHashWithLength: {\n\t\t\t\t\t\tjavascript: length => {\n\t\t\t\t\t\t\tconst shortContentHashMap = {};\n\t\t\t\t\t\t\tconst contentHash = chunkMaps.contentHash.javascript;\n\t\t\t\t\t\t\tfor (const chunkId of Object.keys(contentHash)) {\n\t\t\t\t\t\t\t\tif (typeof contentHash[chunkId] === \"string\") {\n\t\t\t\t\t\t\t\t\tshortContentHashMap[chunkId] = contentHash[chunkId].substr(\n\t\t\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\t\t\tlength\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn `\" + ${JSON.stringify(\n\t\t\t\t\t\t\t\tshortContentHashMap\n\t\t\t\t\t\t\t)}[${chunkIdExpression}] + \"`;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcontentHashType: \"javascript\"\n\t\t\t});\n\t\t};\n\t\tmainTemplate.hooks.localVars.tap(\n\t\t\t\"JsonpMainTemplatePlugin\",\n\t\t\t(source, chunk, hash) => {\n\t\t\t\tconst extraCode = [];\n\t\t\t\tif (needChunkLoadingCode(chunk)) {\n\t\t\t\t\textraCode.push(\n\t\t\t\t\t\t\"\",\n\t\t\t\t\t\t\"// object to store loaded and loading chunks\",\n\t\t\t\t\t\t\"// undefined = chunk not loaded, null = chunk preloaded/prefetched\",\n\t\t\t\t\t\t\"// Promise = chunk loading, 0 = chunk loaded\",\n\t\t\t\t\t\t\"var installedChunks = {\",\n\t\t\t\t\t\tTemplate.indent(\n\t\t\t\t\t\t\tchunk.ids.map(id => `${JSON.stringify(id)}: 0`).join(\",\\n\")\n\t\t\t\t\t\t),\n\t\t\t\t\t\t\"};\",\n\t\t\t\t\t\t\"\",\n\t\t\t\t\t\tneedEntryDeferringCode(chunk)\n\t\t\t\t\t\t\t? needPrefetchingCode(chunk)\n\t\t\t\t\t\t\t\t? \"var deferredModules = [], deferredPrefetch = [];\"\n\t\t\t\t\t\t\t\t: \"var deferredModules = [];\"\n\t\t\t\t\t\t\t: \"\"\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tif (needChunkOnDemandLoadingCode(chunk)) {\n\t\t\t\t\textraCode.push(\n\t\t\t\t\t\t\"\",\n\t\t\t\t\t\t\"// script path function\",\n\t\t\t\t\t\t\"function jsonpScriptSrc(chunkId) {\",\n\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t`return ${mainTemplate.requireFn}.p + ${getScriptSrcPath(\n\t\t\t\t\t\t\t\thash,\n\t\t\t\t\t\t\t\tchunk,\n\t\t\t\t\t\t\t\t\"chunkId\"\n\t\t\t\t\t\t\t)}`\n\t\t\t\t\t\t]),\n\t\t\t\t\t\t\"}\"\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tif (extraCode.length === 0) return source;\n\t\t\t\treturn Template.asString([source, ...extraCode]);\n\t\t\t}\n\t\t);\n\n\t\tmainTemplate.hooks.jsonpScript.tap(\n\t\t\t\"JsonpMainTemplatePlugin\",\n\t\t\t(_, chunk, hash) => {\n\t\t\t\tconst crossOriginLoading =\n\t\t\t\t\tmainTemplate.outputOptions.crossOriginLoading;\n\t\t\t\tconst chunkLoadTimeout = mainTemplate.outputOptions.chunkLoadTimeout;\n\t\t\t\tconst jsonpScriptType = mainTemplate.outputOptions.jsonpScriptType;\n\n\t\t\t\treturn Template.asString([\n\t\t\t\t\t\"var script = document.createElement('script');\",\n\t\t\t\t\t\"var onScriptComplete;\",\n\t\t\t\t\tjsonpScriptType\n\t\t\t\t\t\t? `script.type = ${JSON.stringify(jsonpScriptType)};`\n\t\t\t\t\t\t: \"\",\n\t\t\t\t\t\"script.charset = 'utf-8';\",\n\t\t\t\t\t`script.timeout = ${chunkLoadTimeout / 1000};`,\n\t\t\t\t\t`if (${mainTemplate.requireFn}.nc) {`,\n\t\t\t\t\tTemplate.indent(\n\t\t\t\t\t\t`script.setAttribute(\"nonce\", ${mainTemplate.requireFn}.nc);`\n\t\t\t\t\t),\n\t\t\t\t\t\"}\",\n\t\t\t\t\t\"script.src = jsonpScriptSrc(chunkId);\",\n\t\t\t\t\tcrossOriginLoading\n\t\t\t\t\t\t? Template.asString([\n\t\t\t\t\t\t\t\t\"if (script.src.indexOf(window.location.origin + '/') !== 0) {\",\n\t\t\t\t\t\t\t\tTemplate.indent(\n\t\t\t\t\t\t\t\t\t`script.crossOrigin = ${JSON.stringify(crossOriginLoading)};`\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\"}\"\n\t\t\t\t\t\t  ])\n\t\t\t\t\t\t: \"\",\n\t\t\t\t\t\"// create error before stack unwound to get useful stacktrace later\",\n\t\t\t\t\t\"var error = new Error();\",\n\t\t\t\t\t\"onScriptComplete = function (event) {\",\n\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\"// avoid mem leaks in IE.\",\n\t\t\t\t\t\t\"script.onerror = script.onload = null;\",\n\t\t\t\t\t\t\"clearTimeout(timeout);\",\n\t\t\t\t\t\t\"var chunk = installedChunks[chunkId];\",\n\t\t\t\t\t\t\"if(chunk !== 0) {\",\n\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\"if(chunk) {\",\n\t\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\t\"var errorType = event && (event.type === 'load' ? 'missing' : event.type);\",\n\t\t\t\t\t\t\t\t\"var realSrc = event && event.target && event.target.src;\",\n\t\t\t\t\t\t\t\t\"error.message = 'Loading chunk ' + chunkId + ' failed.\\\\n(' + errorType + ': ' + realSrc + ')';\",\n\t\t\t\t\t\t\t\t\"error.name = 'ChunkLoadError';\",\n\t\t\t\t\t\t\t\t\"error.type = errorType;\",\n\t\t\t\t\t\t\t\t\"error.request = realSrc;\",\n\t\t\t\t\t\t\t\t\"chunk[1](error);\"\n\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\"}\",\n\t\t\t\t\t\t\t\"installedChunks[chunkId] = undefined;\"\n\t\t\t\t\t\t]),\n\t\t\t\t\t\t\"}\"\n\t\t\t\t\t]),\n\t\t\t\t\t\"};\",\n\t\t\t\t\t\"var timeout = setTimeout(function(){\",\n\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\"onScriptComplete({ type: 'timeout', target: script });\"\n\t\t\t\t\t]),\n\t\t\t\t\t`}, ${chunkLoadTimeout});`,\n\t\t\t\t\t\"script.onerror = script.onload = onScriptComplete;\"\n\t\t\t\t]);\n\t\t\t}\n\t\t);\n\t\tmainTemplate.hooks.linkPreload.tap(\n\t\t\t\"JsonpMainTemplatePlugin\",\n\t\t\t(_, chunk, hash) => {\n\t\t\t\tconst crossOriginLoading =\n\t\t\t\t\tmainTemplate.outputOptions.crossOriginLoading;\n\t\t\t\tconst jsonpScriptType = mainTemplate.outputOptions.jsonpScriptType;\n\n\t\t\t\treturn Template.asString([\n\t\t\t\t\t\"var link = document.createElement('link');\",\n\t\t\t\t\tjsonpScriptType\n\t\t\t\t\t\t? `link.type = ${JSON.stringify(jsonpScriptType)};`\n\t\t\t\t\t\t: \"\",\n\t\t\t\t\t\"link.charset = 'utf-8';\",\n\t\t\t\t\t`if (${mainTemplate.requireFn}.nc) {`,\n\t\t\t\t\tTemplate.indent(\n\t\t\t\t\t\t`link.setAttribute(\"nonce\", ${mainTemplate.requireFn}.nc);`\n\t\t\t\t\t),\n\t\t\t\t\t\"}\",\n\t\t\t\t\t'link.rel = \"preload\";',\n\t\t\t\t\t'link.as = \"script\";',\n\t\t\t\t\t\"link.href = jsonpScriptSrc(chunkId);\",\n\t\t\t\t\tcrossOriginLoading\n\t\t\t\t\t\t? Template.asString([\n\t\t\t\t\t\t\t\t\"if (link.href.indexOf(window.location.origin + '/') !== 0) {\",\n\t\t\t\t\t\t\t\tTemplate.indent(\n\t\t\t\t\t\t\t\t\t`link.crossOrigin = ${JSON.stringify(crossOriginLoading)};`\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\"}\"\n\t\t\t\t\t\t  ])\n\t\t\t\t\t\t: \"\"\n\t\t\t\t]);\n\t\t\t}\n\t\t);\n\t\tmainTemplate.hooks.linkPrefetch.tap(\n\t\t\t\"JsonpMainTemplatePlugin\",\n\t\t\t(_, chunk, hash) => {\n\t\t\t\tconst crossOriginLoading =\n\t\t\t\t\tmainTemplate.outputOptions.crossOriginLoading;\n\n\t\t\t\treturn Template.asString([\n\t\t\t\t\t\"var link = document.createElement('link');\",\n\t\t\t\t\tcrossOriginLoading\n\t\t\t\t\t\t? `link.crossOrigin = ${JSON.stringify(crossOriginLoading)};`\n\t\t\t\t\t\t: \"\",\n\t\t\t\t\t`if (${mainTemplate.requireFn}.nc) {`,\n\t\t\t\t\tTemplate.indent(\n\t\t\t\t\t\t`link.setAttribute(\"nonce\", ${mainTemplate.requireFn}.nc);`\n\t\t\t\t\t),\n\t\t\t\t\t\"}\",\n\t\t\t\t\t'link.rel = \"prefetch\";',\n\t\t\t\t\t'link.as = \"script\";',\n\t\t\t\t\t\"link.href = jsonpScriptSrc(chunkId);\"\n\t\t\t\t]);\n\t\t\t}\n\t\t);\n\t\tmainTemplate.hooks.requireEnsure.tap(\n\t\t\t\"JsonpMainTemplatePlugin load\",\n\t\t\t(source, chunk, hash) => {\n\t\t\t\treturn Template.asString([\n\t\t\t\t\tsource,\n\t\t\t\t\t\"\",\n\t\t\t\t\t\"// JSONP chunk loading for javascript\",\n\t\t\t\t\t\"\",\n\t\t\t\t\t\"var installedChunkData = installedChunks[chunkId];\",\n\t\t\t\t\t'if(installedChunkData !== 0) { // 0 means \"already installed\".',\n\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\"\",\n\t\t\t\t\t\t'// a Promise means \"currently loading\".',\n\t\t\t\t\t\t\"if(installedChunkData) {\",\n\t\t\t\t\t\tTemplate.indent([\"promises.push(installedChunkData[2]);\"]),\n\t\t\t\t\t\t\"} else {\",\n\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\"// setup Promise in chunk cache\",\n\t\t\t\t\t\t\t\"var promise = new Promise(function(resolve, reject) {\",\n\t\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\t\"installedChunkData = installedChunks[chunkId] = [resolve, reject];\"\n\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\"});\",\n\t\t\t\t\t\t\t\"promises.push(installedChunkData[2] = promise);\",\n\t\t\t\t\t\t\t\"\",\n\t\t\t\t\t\t\t\"// start chunk loading\",\n\t\t\t\t\t\t\tmainTemplate.hooks.jsonpScript.call(\"\", chunk, hash),\n\t\t\t\t\t\t\t\"document.head.appendChild(script);\"\n\t\t\t\t\t\t]),\n\t\t\t\t\t\t\"}\"\n\t\t\t\t\t]),\n\t\t\t\t\t\"}\"\n\t\t\t\t]);\n\t\t\t}\n\t\t);\n\t\tmainTemplate.hooks.requireEnsure.tap(\n\t\t\t{\n\t\t\t\tname: \"JsonpMainTemplatePlugin preload\",\n\t\t\t\tstage: 10\n\t\t\t},\n\t\t\t(source, chunk, hash) => {\n\t\t\t\tconst chunkMap = chunk.getChildIdsByOrdersMap().preload;\n\t\t\t\tif (!chunkMap || Object.keys(chunkMap).length === 0) return source;\n\t\t\t\treturn Template.asString([\n\t\t\t\t\tsource,\n\t\t\t\t\t\"\",\n\t\t\t\t\t\"// chunk preloadng for javascript\",\n\t\t\t\t\t\"\",\n\t\t\t\t\t`var chunkPreloadMap = ${JSON.stringify(chunkMap, null, \"\\t\")};`,\n\t\t\t\t\t\"\",\n\t\t\t\t\t\"var chunkPreloadData = chunkPreloadMap[chunkId];\",\n\t\t\t\t\t\"if(chunkPreloadData) {\",\n\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\"chunkPreloadData.forEach(function(chunkId) {\",\n\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\"if(installedChunks[chunkId] === undefined) {\",\n\t\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\t\"installedChunks[chunkId] = null;\",\n\t\t\t\t\t\t\t\tmainTemplate.hooks.linkPreload.call(\"\", chunk, hash),\n\t\t\t\t\t\t\t\t\"document.head.appendChild(link);\"\n\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\"}\"\n\t\t\t\t\t\t]),\n\t\t\t\t\t\t\"});\"\n\t\t\t\t\t]),\n\t\t\t\t\t\"}\"\n\t\t\t\t]);\n\t\t\t}\n\t\t);\n\t\tmainTemplate.hooks.requireExtensions.tap(\n\t\t\t\"JsonpMainTemplatePlugin\",\n\t\t\t(source, chunk) => {\n\t\t\t\tif (!needChunkOnDemandLoadingCode(chunk)) return source;\n\n\t\t\t\treturn Template.asString([\n\t\t\t\t\tsource,\n\t\t\t\t\t\"\",\n\t\t\t\t\t\"// on error function for async loading\",\n\t\t\t\t\t`${mainTemplate.requireFn}.oe = function(err) { console.error(err); throw err; };`\n\t\t\t\t]);\n\t\t\t}\n\t\t);\n\t\tmainTemplate.hooks.bootstrap.tap(\n\t\t\t\"JsonpMainTemplatePlugin\",\n\t\t\t(source, chunk, hash) => {\n\t\t\t\tif (needChunkLoadingCode(chunk)) {\n\t\t\t\t\tconst withDefer = needEntryDeferringCode(chunk);\n\t\t\t\t\tconst withPrefetch = needPrefetchingCode(chunk);\n\t\t\t\t\treturn Template.asString([\n\t\t\t\t\t\tsource,\n\t\t\t\t\t\t\"\",\n\t\t\t\t\t\t\"// install a JSONP callback for chunk loading\",\n\t\t\t\t\t\t\"function webpackJsonpCallback(data) {\",\n\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\"var chunkIds = data[0];\",\n\t\t\t\t\t\t\t\"var moreModules = data[1];\",\n\t\t\t\t\t\t\twithDefer ? \"var executeModules = data[2];\" : \"\",\n\t\t\t\t\t\t\twithPrefetch ? \"var prefetchChunks = data[3] || [];\" : \"\",\n\t\t\t\t\t\t\t'// add \"moreModules\" to the modules object,',\n\t\t\t\t\t\t\t'// then flag all \"chunkIds\" as loaded and fire callback',\n\t\t\t\t\t\t\t\"var moduleId, chunkId, i = 0, resolves = [];\",\n\t\t\t\t\t\t\t\"for(;i < chunkIds.length; i++) {\",\n\t\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\t\"chunkId = chunkIds[i];\",\n\t\t\t\t\t\t\t\t\"if(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\",\n\t\t\t\t\t\t\t\tTemplate.indent(\"resolves.push(installedChunks[chunkId][0]);\"),\n\t\t\t\t\t\t\t\t\"}\",\n\t\t\t\t\t\t\t\t\"installedChunks[chunkId] = 0;\"\n\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\"}\",\n\t\t\t\t\t\t\t\"for(moduleId in moreModules) {\",\n\t\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\t\"if(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\",\n\t\t\t\t\t\t\t\tTemplate.indent(\n\t\t\t\t\t\t\t\t\tmainTemplate.renderAddModule(\n\t\t\t\t\t\t\t\t\t\thash,\n\t\t\t\t\t\t\t\t\t\tchunk,\n\t\t\t\t\t\t\t\t\t\t\"moduleId\",\n\t\t\t\t\t\t\t\t\t\t\"moreModules[moduleId]\"\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\"}\"\n\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\"}\",\n\t\t\t\t\t\t\t\"if(parentJsonpFunction) parentJsonpFunction(data);\",\n\t\t\t\t\t\t\twithPrefetch\n\t\t\t\t\t\t\t\t? withDefer\n\t\t\t\t\t\t\t\t\t? \"deferredPrefetch.push.apply(deferredPrefetch, prefetchChunks);\"\n\t\t\t\t\t\t\t\t\t: Template.asString([\n\t\t\t\t\t\t\t\t\t\t\t\"// chunk prefetching for javascript\",\n\t\t\t\t\t\t\t\t\t\t\t\"prefetchChunks.forEach(function(chunkId) {\",\n\t\t\t\t\t\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\t\t\t\t\t\"if(installedChunks[chunkId] === undefined) {\",\n\t\t\t\t\t\t\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"installedChunks[chunkId] = null;\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tmainTemplate.hooks.linkPrefetch.call(\"\", chunk, hash),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"document.head.appendChild(link);\"\n\t\t\t\t\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t\t\t\t\t\"}\"\n\t\t\t\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t\t\t\t\"});\"\n\t\t\t\t\t\t\t\t\t  ])\n\t\t\t\t\t\t\t\t: \"\",\n\t\t\t\t\t\t\t\"while(resolves.length) {\",\n\t\t\t\t\t\t\tTemplate.indent(\"resolves.shift()();\"),\n\t\t\t\t\t\t\t\"}\",\n\t\t\t\t\t\t\twithDefer\n\t\t\t\t\t\t\t\t? Template.asString([\n\t\t\t\t\t\t\t\t\t\t\"\",\n\t\t\t\t\t\t\t\t\t\t\"// add entry modules from loaded chunk to deferred list\",\n\t\t\t\t\t\t\t\t\t\t\"deferredModules.push.apply(deferredModules, executeModules || []);\",\n\t\t\t\t\t\t\t\t\t\t\"\",\n\t\t\t\t\t\t\t\t\t\t\"// run deferred modules when all chunks ready\",\n\t\t\t\t\t\t\t\t\t\t\"return checkDeferredModules();\"\n\t\t\t\t\t\t\t\t  ])\n\t\t\t\t\t\t\t\t: \"\"\n\t\t\t\t\t\t]),\n\t\t\t\t\t\t\"};\",\n\t\t\t\t\t\twithDefer\n\t\t\t\t\t\t\t? Template.asString([\n\t\t\t\t\t\t\t\t\t\"function checkDeferredModules() {\",\n\t\t\t\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\t\t\t\"var result;\",\n\t\t\t\t\t\t\t\t\t\t\"for(var i = 0; i < deferredModules.length; i++) {\",\n\t\t\t\t\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\t\t\t\t\"var deferredModule = deferredModules[i];\",\n\t\t\t\t\t\t\t\t\t\t\t\"var fulfilled = true;\",\n\t\t\t\t\t\t\t\t\t\t\t\"for(var j = 1; j < deferredModule.length; j++) {\",\n\t\t\t\t\t\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\t\t\t\t\t\"var depId = deferredModule[j];\",\n\t\t\t\t\t\t\t\t\t\t\t\t\"if(installedChunks[depId] !== 0) fulfilled = false;\"\n\t\t\t\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t\t\t\t\"}\",\n\t\t\t\t\t\t\t\t\t\t\t\"if(fulfilled) {\",\n\t\t\t\t\t\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\t\t\t\t\t\"deferredModules.splice(i--, 1);\",\n\t\t\t\t\t\t\t\t\t\t\t\t\"result = \" +\n\t\t\t\t\t\t\t\t\t\t\t\t\tmainTemplate.requireFn +\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"(\" +\n\t\t\t\t\t\t\t\t\t\t\t\t\tmainTemplate.requireFn +\n\t\t\t\t\t\t\t\t\t\t\t\t\t\".s = deferredModule[0]);\"\n\t\t\t\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t\t\t\t\"}\"\n\t\t\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t\t\t\"}\",\n\t\t\t\t\t\t\t\t\t\twithPrefetch\n\t\t\t\t\t\t\t\t\t\t\t? Template.asString([\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"if(deferredModules.length === 0) {\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"// chunk prefetching for javascript\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"deferredPrefetch.forEach(function(chunkId) {\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"if(installedChunks[chunkId] === undefined) {\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"installedChunks[chunkId] = null;\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmainTemplate.hooks.linkPrefetch.call(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tchunk,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thash\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"document.head.appendChild(link);\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"});\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"deferredPrefetch.length = 0;\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"}\"\n\t\t\t\t\t\t\t\t\t\t\t  ])\n\t\t\t\t\t\t\t\t\t\t\t: \"\",\n\t\t\t\t\t\t\t\t\t\t\"return result;\"\n\t\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t\t\"}\"\n\t\t\t\t\t\t\t  ])\n\t\t\t\t\t\t\t: \"\"\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t\treturn source;\n\t\t\t}\n\t\t);\n\t\tmainTemplate.hooks.beforeStartup.tap(\n\t\t\t\"JsonpMainTemplatePlugin\",\n\t\t\t(source, chunk, hash) => {\n\t\t\t\tif (needChunkLoadingCode(chunk)) {\n\t\t\t\t\tvar jsonpFunction = mainTemplate.outputOptions.jsonpFunction;\n\t\t\t\t\tvar globalObject = mainTemplate.outputOptions.globalObject;\n\t\t\t\t\treturn Template.asString([\n\t\t\t\t\t\t`var jsonpArray = ${globalObject}[${JSON.stringify(\n\t\t\t\t\t\t\tjsonpFunction\n\t\t\t\t\t\t)}] = ${globalObject}[${JSON.stringify(jsonpFunction)}] || [];`,\n\t\t\t\t\t\t\"var oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\",\n\t\t\t\t\t\t\"jsonpArray.push = webpackJsonpCallback;\",\n\t\t\t\t\t\t\"jsonpArray = jsonpArray.slice();\",\n\t\t\t\t\t\t\"for(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\",\n\t\t\t\t\t\t\"var parentJsonpFunction = oldJsonpFunction;\",\n\t\t\t\t\t\t\"\",\n\t\t\t\t\t\tsource\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t\treturn source;\n\t\t\t}\n\t\t);\n\t\tmainTemplate.hooks.afterStartup.tap(\n\t\t\t\"JsonpMainTemplatePlugin\",\n\t\t\t(source, chunk, hash) => {\n\t\t\t\tconst prefetchChunks = chunk.getChildIdsByOrders().prefetch;\n\t\t\t\tif (\n\t\t\t\t\tneedChunkLoadingCode(chunk) &&\n\t\t\t\t\tprefetchChunks &&\n\t\t\t\t\tprefetchChunks.length\n\t\t\t\t) {\n\t\t\t\t\treturn Template.asString([\n\t\t\t\t\t\tsource,\n\t\t\t\t\t\t`webpackJsonpCallback([[], {}, 0, ${JSON.stringify(\n\t\t\t\t\t\t\tprefetchChunks\n\t\t\t\t\t\t)}]);`\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t\treturn source;\n\t\t\t}\n\t\t);\n\t\tmainTemplate.hooks.startup.tap(\n\t\t\t\"JsonpMainTemplatePlugin\",\n\t\t\t(source, chunk, hash) => {\n\t\t\t\tif (needEntryDeferringCode(chunk)) {\n\t\t\t\t\tif (chunk.hasEntryModule()) {\n\t\t\t\t\t\tconst entries = [chunk.entryModule].filter(Boolean).map(m =>\n\t\t\t\t\t\t\t[m.id].concat(\n\t\t\t\t\t\t\t\tArray.from(chunk.groupsIterable)[0]\n\t\t\t\t\t\t\t\t\t.chunks.filter(c => c !== chunk)\n\t\t\t\t\t\t\t\t\t.map(c => c.id)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn Template.asString([\n\t\t\t\t\t\t\t\"// add entry module to deferred list\",\n\t\t\t\t\t\t\t`deferredModules.push(${entries\n\t\t\t\t\t\t\t\t.map(e => JSON.stringify(e))\n\t\t\t\t\t\t\t\t.join(\", \")});`,\n\t\t\t\t\t\t\t\"// run deferred modules when ready\",\n\t\t\t\t\t\t\t\"return checkDeferredModules();\"\n\t\t\t\t\t\t]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn Template.asString([\n\t\t\t\t\t\t\t\"// run deferred modules from other chunks\",\n\t\t\t\t\t\t\t\"checkDeferredModules();\"\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn source;\n\t\t\t}\n\t\t);\n\t\tmainTemplate.hooks.hotBootstrap.tap(\n\t\t\t\"JsonpMainTemplatePlugin\",\n\t\t\t(source, chunk, hash) => {\n\t\t\t\tconst globalObject = mainTemplate.outputOptions.globalObject;\n\t\t\t\tconst hotUpdateChunkFilename =\n\t\t\t\t\tmainTemplate.outputOptions.hotUpdateChunkFilename;\n\t\t\t\tconst hotUpdateMainFilename =\n\t\t\t\t\tmainTemplate.outputOptions.hotUpdateMainFilename;\n\t\t\t\tconst crossOriginLoading =\n\t\t\t\t\tmainTemplate.outputOptions.crossOriginLoading;\n\t\t\t\tconst hotUpdateFunction = mainTemplate.outputOptions.hotUpdateFunction;\n\t\t\t\tconst currentHotUpdateChunkFilename = mainTemplate.getAssetPath(\n\t\t\t\t\tJSON.stringify(hotUpdateChunkFilename),\n\t\t\t\t\t{\n\t\t\t\t\t\thash: `\" + ${mainTemplate.renderCurrentHashCode(hash)} + \"`,\n\t\t\t\t\t\thashWithLength: length =>\n\t\t\t\t\t\t\t`\" + ${mainTemplate.renderCurrentHashCode(hash, length)} + \"`,\n\t\t\t\t\t\tchunk: {\n\t\t\t\t\t\t\tid: '\" + chunkId + \"'\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tconst currentHotUpdateMainFilename = mainTemplate.getAssetPath(\n\t\t\t\t\tJSON.stringify(hotUpdateMainFilename),\n\t\t\t\t\t{\n\t\t\t\t\t\thash: `\" + ${mainTemplate.renderCurrentHashCode(hash)} + \"`,\n\t\t\t\t\t\thashWithLength: length =>\n\t\t\t\t\t\t\t`\" + ${mainTemplate.renderCurrentHashCode(hash, length)} + \"`\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tconst runtimeSource = Template.getFunctionContent(\n\t\t\t\t\trequire(\"./JsonpMainTemplate.runtime\")\n\t\t\t\t)\n\t\t\t\t\t.replace(/\\/\\/\\$semicolon/g, \";\")\n\t\t\t\t\t.replace(/\\$require\\$/g, mainTemplate.requireFn)\n\t\t\t\t\t.replace(\n\t\t\t\t\t\t/\\$crossOriginLoading\\$/g,\n\t\t\t\t\t\tcrossOriginLoading ? JSON.stringify(crossOriginLoading) : \"null\"\n\t\t\t\t\t)\n\t\t\t\t\t.replace(/\\$hotMainFilename\\$/g, currentHotUpdateMainFilename)\n\t\t\t\t\t.replace(/\\$hotChunkFilename\\$/g, currentHotUpdateChunkFilename)\n\t\t\t\t\t.replace(/\\$hash\\$/g, JSON.stringify(hash));\n\t\t\t\treturn `${source}\nfunction hotDisposeChunk(chunkId) {\n\tdelete installedChunks[chunkId];\n}\nvar parentHotUpdateCallback = ${globalObject}[${JSON.stringify(\n\t\t\t\t\thotUpdateFunction\n\t\t\t\t)}];\n${globalObject}[${JSON.stringify(hotUpdateFunction)}] = ${runtimeSource}`;\n\t\t\t}\n\t\t);\n\t\tmainTemplate.hooks.hash.tap(\"JsonpMainTemplatePlugin\", hash => {\n\t\t\thash.update(\"jsonp\");\n\t\t\thash.update(\"6\");\n\t\t});\n\t}\n}\nmodule.exports = JsonpMainTemplatePlugin;\n"]},"metadata":{},"sourceType":"script"}