{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nclass Storage {\n  constructor(duration) {\n    this.duration = duration;\n    this.running = new Map();\n    this.data = new Map();\n    this.levels = [];\n\n    if (duration > 0) {\n      this.levels.push(new Set(), new Set(), new Set(), new Set(), new Set(), new Set(), new Set(), new Set(), new Set());\n\n      for (let i = 8000; i < duration; i += 500) this.levels.push(new Set());\n    }\n\n    this.count = 0;\n    this.interval = null;\n    this.needTickCheck = false;\n    this.nextTick = null;\n    this.passive = true;\n    this.tick = this.tick.bind(this);\n  }\n\n  ensureTick() {\n    if (!this.interval && this.duration > 0 && !this.nextTick) this.interval = setInterval(this.tick, Math.floor(this.duration / this.levels.length));\n  }\n\n  finished(name, err, result) {\n    const callbacks = this.running.get(name);\n    this.running.delete(name);\n\n    if (this.duration > 0) {\n      this.data.set(name, [err, result]);\n      const levelData = this.levels[0];\n      this.count -= levelData.size;\n      levelData.add(name);\n      this.count += levelData.size;\n      this.ensureTick();\n    }\n\n    for (let i = 0; i < callbacks.length; i++) {\n      callbacks[i](err, result);\n    }\n  }\n\n  finishedSync(name, err, result) {\n    if (this.duration > 0) {\n      this.data.set(name, [err, result]);\n      const levelData = this.levels[0];\n      this.count -= levelData.size;\n      levelData.add(name);\n      this.count += levelData.size;\n      this.ensureTick();\n    }\n  }\n\n  provide(name, provider, callback) {\n    if (typeof name !== \"string\") {\n      callback(new TypeError(\"path must be a string\"));\n      return;\n    }\n\n    let running = this.running.get(name);\n\n    if (running) {\n      running.push(callback);\n      return;\n    }\n\n    if (this.duration > 0) {\n      this.checkTicks();\n      const data = this.data.get(name);\n\n      if (data) {\n        return process.nextTick(() => {\n          callback.apply(null, data);\n        });\n      }\n    }\n\n    this.running.set(name, running = [callback]);\n    provider(name, (err, result) => {\n      this.finished(name, err, result);\n    });\n  }\n\n  provideSync(name, provider) {\n    if (typeof name !== \"string\") {\n      throw new TypeError(\"path must be a string\");\n    }\n\n    if (this.duration > 0) {\n      this.checkTicks();\n      const data = this.data.get(name);\n\n      if (data) {\n        if (data[0]) throw data[0];\n        return data[1];\n      }\n    }\n\n    let result;\n\n    try {\n      result = provider(name);\n    } catch (e) {\n      this.finishedSync(name, e);\n      throw e;\n    }\n\n    this.finishedSync(name, null, result);\n    return result;\n  }\n\n  tick() {\n    const decay = this.levels.pop();\n\n    for (let item of decay) {\n      this.data.delete(item);\n    }\n\n    this.count -= decay.size;\n    decay.clear();\n    this.levels.unshift(decay);\n\n    if (this.count === 0) {\n      clearInterval(this.interval);\n      this.interval = null;\n      this.nextTick = null;\n      return true;\n    } else if (this.nextTick) {\n      this.nextTick += Math.floor(this.duration / this.levels.length);\n      const time = new Date().getTime();\n\n      if (this.nextTick > time) {\n        this.nextTick = null;\n        this.interval = setInterval(this.tick, Math.floor(this.duration / this.levels.length));\n        return true;\n      }\n    } else if (this.passive) {\n      clearInterval(this.interval);\n      this.interval = null;\n      this.nextTick = new Date().getTime() + Math.floor(this.duration / this.levels.length);\n    } else {\n      this.passive = true;\n    }\n  }\n\n  checkTicks() {\n    this.passive = false;\n\n    if (this.nextTick) {\n      while (!this.tick());\n    }\n  }\n\n  purge(what) {\n    if (!what) {\n      this.count = 0;\n      clearInterval(this.interval);\n      this.nextTick = null;\n      this.data.clear();\n      this.levels.forEach(level => {\n        level.clear();\n      });\n    } else if (typeof what === \"string\") {\n      for (let key of this.data.keys()) {\n        if (key.startsWith(what)) this.data.delete(key);\n      }\n    } else {\n      for (let i = what.length - 1; i >= 0; i--) {\n        this.purge(what[i]);\n      }\n    }\n  }\n\n}\n\nmodule.exports = class CachedInputFileSystem {\n  constructor(fileSystem, duration) {\n    this.fileSystem = fileSystem;\n    this._statStorage = new Storage(duration);\n    this._readdirStorage = new Storage(duration);\n    this._readFileStorage = new Storage(duration);\n    this._readJsonStorage = new Storage(duration);\n    this._readlinkStorage = new Storage(duration);\n    this._stat = this.fileSystem.stat ? this.fileSystem.stat.bind(this.fileSystem) : null;\n    if (!this._stat) this.stat = null;\n    this._statSync = this.fileSystem.statSync ? this.fileSystem.statSync.bind(this.fileSystem) : null;\n    if (!this._statSync) this.statSync = null;\n    this._readdir = this.fileSystem.readdir ? this.fileSystem.readdir.bind(this.fileSystem) : null;\n    if (!this._readdir) this.readdir = null;\n    this._readdirSync = this.fileSystem.readdirSync ? this.fileSystem.readdirSync.bind(this.fileSystem) : null;\n    if (!this._readdirSync) this.readdirSync = null;\n    this._readFile = this.fileSystem.readFile ? this.fileSystem.readFile.bind(this.fileSystem) : null;\n    if (!this._readFile) this.readFile = null;\n    this._readFileSync = this.fileSystem.readFileSync ? this.fileSystem.readFileSync.bind(this.fileSystem) : null;\n    if (!this._readFileSync) this.readFileSync = null;\n\n    if (this.fileSystem.readJson) {\n      this._readJson = this.fileSystem.readJson.bind(this.fileSystem);\n    } else if (this.readFile) {\n      this._readJson = (path, callback) => {\n        this.readFile(path, (err, buffer) => {\n          if (err) return callback(err);\n          let data;\n\n          try {\n            data = JSON.parse(buffer.toString(\"utf-8\"));\n          } catch (e) {\n            return callback(e);\n          }\n\n          callback(null, data);\n        });\n      };\n    } else {\n      this.readJson = null;\n    }\n\n    if (this.fileSystem.readJsonSync) {\n      this._readJsonSync = this.fileSystem.readJsonSync.bind(this.fileSystem);\n    } else if (this.readFileSync) {\n      this._readJsonSync = path => {\n        const buffer = this.readFileSync(path);\n        const data = JSON.parse(buffer.toString(\"utf-8\"));\n        return data;\n      };\n    } else {\n      this.readJsonSync = null;\n    }\n\n    this._readlink = this.fileSystem.readlink ? this.fileSystem.readlink.bind(this.fileSystem) : null;\n    if (!this._readlink) this.readlink = null;\n    this._readlinkSync = this.fileSystem.readlinkSync ? this.fileSystem.readlinkSync.bind(this.fileSystem) : null;\n    if (!this._readlinkSync) this.readlinkSync = null;\n  }\n\n  stat(path, callback) {\n    this._statStorage.provide(path, this._stat, callback);\n  }\n\n  readdir(path, callback) {\n    this._readdirStorage.provide(path, this._readdir, callback);\n  }\n\n  readFile(path, callback) {\n    this._readFileStorage.provide(path, this._readFile, callback);\n  }\n\n  readJson(path, callback) {\n    this._readJsonStorage.provide(path, this._readJson, callback);\n  }\n\n  readlink(path, callback) {\n    this._readlinkStorage.provide(path, this._readlink, callback);\n  }\n\n  statSync(path) {\n    return this._statStorage.provideSync(path, this._statSync);\n  }\n\n  readdirSync(path) {\n    return this._readdirStorage.provideSync(path, this._readdirSync);\n  }\n\n  readFileSync(path) {\n    return this._readFileStorage.provideSync(path, this._readFileSync);\n  }\n\n  readJsonSync(path) {\n    return this._readJsonStorage.provideSync(path, this._readJsonSync);\n  }\n\n  readlinkSync(path) {\n    return this._readlinkStorage.provideSync(path, this._readlinkSync);\n  }\n\n  purge(what) {\n    this._statStorage.purge(what);\n\n    this._readdirStorage.purge(what);\n\n    this._readFileStorage.purge(what);\n\n    this._readlinkStorage.purge(what);\n\n    this._readJsonStorage.purge(what);\n  }\n\n};","map":{"version":3,"sources":["/Users/hamzakhan/Documents/twitter-react/twitter/node_modules/enhanced-resolve/lib/CachedInputFileSystem.js"],"names":["Storage","constructor","duration","running","Map","data","levels","push","Set","i","count","interval","needTickCheck","nextTick","passive","tick","bind","ensureTick","setInterval","Math","floor","length","finished","name","err","result","callbacks","get","delete","set","levelData","size","add","finishedSync","provide","provider","callback","TypeError","checkTicks","process","apply","provideSync","e","decay","pop","item","clear","unshift","clearInterval","time","Date","getTime","purge","what","forEach","level","key","keys","startsWith","module","exports","CachedInputFileSystem","fileSystem","_statStorage","_readdirStorage","_readFileStorage","_readJsonStorage","_readlinkStorage","_stat","stat","_statSync","statSync","_readdir","readdir","_readdirSync","readdirSync","_readFile","readFile","_readFileSync","readFileSync","readJson","_readJson","path","buffer","JSON","parse","toString","readJsonSync","_readJsonSync","_readlink","readlink","_readlinkSync","readlinkSync"],"mappings":"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","sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nclass Storage {\n\tconstructor(duration) {\n\t\tthis.duration = duration;\n\t\tthis.running = new Map();\n\t\tthis.data = new Map();\n\t\tthis.levels = [];\n\t\tif (duration > 0) {\n\t\t\tthis.levels.push(\n\t\t\t\tnew Set(),\n\t\t\t\tnew Set(),\n\t\t\t\tnew Set(),\n\t\t\t\tnew Set(),\n\t\t\t\tnew Set(),\n\t\t\t\tnew Set(),\n\t\t\t\tnew Set(),\n\t\t\t\tnew Set(),\n\t\t\t\tnew Set()\n\t\t\t);\n\t\t\tfor (let i = 8000; i < duration; i += 500) this.levels.push(new Set());\n\t\t}\n\t\tthis.count = 0;\n\t\tthis.interval = null;\n\t\tthis.needTickCheck = false;\n\t\tthis.nextTick = null;\n\t\tthis.passive = true;\n\t\tthis.tick = this.tick.bind(this);\n\t}\n\n\tensureTick() {\n\t\tif (!this.interval && this.duration > 0 && !this.nextTick)\n\t\t\tthis.interval = setInterval(\n\t\t\t\tthis.tick,\n\t\t\t\tMath.floor(this.duration / this.levels.length)\n\t\t\t);\n\t}\n\n\tfinished(name, err, result) {\n\t\tconst callbacks = this.running.get(name);\n\t\tthis.running.delete(name);\n\t\tif (this.duration > 0) {\n\t\t\tthis.data.set(name, [err, result]);\n\t\t\tconst levelData = this.levels[0];\n\t\t\tthis.count -= levelData.size;\n\t\t\tlevelData.add(name);\n\t\t\tthis.count += levelData.size;\n\t\t\tthis.ensureTick();\n\t\t}\n\t\tfor (let i = 0; i < callbacks.length; i++) {\n\t\t\tcallbacks[i](err, result);\n\t\t}\n\t}\n\n\tfinishedSync(name, err, result) {\n\t\tif (this.duration > 0) {\n\t\t\tthis.data.set(name, [err, result]);\n\t\t\tconst levelData = this.levels[0];\n\t\t\tthis.count -= levelData.size;\n\t\t\tlevelData.add(name);\n\t\t\tthis.count += levelData.size;\n\t\t\tthis.ensureTick();\n\t\t}\n\t}\n\n\tprovide(name, provider, callback) {\n\t\tif (typeof name !== \"string\") {\n\t\t\tcallback(new TypeError(\"path must be a string\"));\n\t\t\treturn;\n\t\t}\n\t\tlet running = this.running.get(name);\n\t\tif (running) {\n\t\t\trunning.push(callback);\n\t\t\treturn;\n\t\t}\n\t\tif (this.duration > 0) {\n\t\t\tthis.checkTicks();\n\t\t\tconst data = this.data.get(name);\n\t\t\tif (data) {\n\t\t\t\treturn process.nextTick(() => {\n\t\t\t\t\tcallback.apply(null, data);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tthis.running.set(name, (running = [callback]));\n\t\tprovider(name, (err, result) => {\n\t\t\tthis.finished(name, err, result);\n\t\t});\n\t}\n\n\tprovideSync(name, provider) {\n\t\tif (typeof name !== \"string\") {\n\t\t\tthrow new TypeError(\"path must be a string\");\n\t\t}\n\t\tif (this.duration > 0) {\n\t\t\tthis.checkTicks();\n\t\t\tconst data = this.data.get(name);\n\t\t\tif (data) {\n\t\t\t\tif (data[0]) throw data[0];\n\t\t\t\treturn data[1];\n\t\t\t}\n\t\t}\n\t\tlet result;\n\t\ttry {\n\t\t\tresult = provider(name);\n\t\t} catch (e) {\n\t\t\tthis.finishedSync(name, e);\n\t\t\tthrow e;\n\t\t}\n\t\tthis.finishedSync(name, null, result);\n\t\treturn result;\n\t}\n\n\ttick() {\n\t\tconst decay = this.levels.pop();\n\t\tfor (let item of decay) {\n\t\t\tthis.data.delete(item);\n\t\t}\n\t\tthis.count -= decay.size;\n\t\tdecay.clear();\n\t\tthis.levels.unshift(decay);\n\t\tif (this.count === 0) {\n\t\t\tclearInterval(this.interval);\n\t\t\tthis.interval = null;\n\t\t\tthis.nextTick = null;\n\t\t\treturn true;\n\t\t} else if (this.nextTick) {\n\t\t\tthis.nextTick += Math.floor(this.duration / this.levels.length);\n\t\t\tconst time = new Date().getTime();\n\t\t\tif (this.nextTick > time) {\n\t\t\t\tthis.nextTick = null;\n\t\t\t\tthis.interval = setInterval(\n\t\t\t\t\tthis.tick,\n\t\t\t\t\tMath.floor(this.duration / this.levels.length)\n\t\t\t\t);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} else if (this.passive) {\n\t\t\tclearInterval(this.interval);\n\t\t\tthis.interval = null;\n\t\t\tthis.nextTick =\n\t\t\t\tnew Date().getTime() + Math.floor(this.duration / this.levels.length);\n\t\t} else {\n\t\t\tthis.passive = true;\n\t\t}\n\t}\n\n\tcheckTicks() {\n\t\tthis.passive = false;\n\t\tif (this.nextTick) {\n\t\t\twhile (!this.tick());\n\t\t}\n\t}\n\n\tpurge(what) {\n\t\tif (!what) {\n\t\t\tthis.count = 0;\n\t\t\tclearInterval(this.interval);\n\t\t\tthis.nextTick = null;\n\t\t\tthis.data.clear();\n\t\t\tthis.levels.forEach(level => {\n\t\t\t\tlevel.clear();\n\t\t\t});\n\t\t} else if (typeof what === \"string\") {\n\t\t\tfor (let key of this.data.keys()) {\n\t\t\t\tif (key.startsWith(what)) this.data.delete(key);\n\t\t\t}\n\t\t} else {\n\t\t\tfor (let i = what.length - 1; i >= 0; i--) {\n\t\t\t\tthis.purge(what[i]);\n\t\t\t}\n\t\t}\n\t}\n}\n\nmodule.exports = class CachedInputFileSystem {\n\tconstructor(fileSystem, duration) {\n\t\tthis.fileSystem = fileSystem;\n\t\tthis._statStorage = new Storage(duration);\n\t\tthis._readdirStorage = new Storage(duration);\n\t\tthis._readFileStorage = new Storage(duration);\n\t\tthis._readJsonStorage = new Storage(duration);\n\t\tthis._readlinkStorage = new Storage(duration);\n\n\t\tthis._stat = this.fileSystem.stat\n\t\t\t? this.fileSystem.stat.bind(this.fileSystem)\n\t\t\t: null;\n\t\tif (!this._stat) this.stat = null;\n\n\t\tthis._statSync = this.fileSystem.statSync\n\t\t\t? this.fileSystem.statSync.bind(this.fileSystem)\n\t\t\t: null;\n\t\tif (!this._statSync) this.statSync = null;\n\n\t\tthis._readdir = this.fileSystem.readdir\n\t\t\t? this.fileSystem.readdir.bind(this.fileSystem)\n\t\t\t: null;\n\t\tif (!this._readdir) this.readdir = null;\n\n\t\tthis._readdirSync = this.fileSystem.readdirSync\n\t\t\t? this.fileSystem.readdirSync.bind(this.fileSystem)\n\t\t\t: null;\n\t\tif (!this._readdirSync) this.readdirSync = null;\n\n\t\tthis._readFile = this.fileSystem.readFile\n\t\t\t? this.fileSystem.readFile.bind(this.fileSystem)\n\t\t\t: null;\n\t\tif (!this._readFile) this.readFile = null;\n\n\t\tthis._readFileSync = this.fileSystem.readFileSync\n\t\t\t? this.fileSystem.readFileSync.bind(this.fileSystem)\n\t\t\t: null;\n\t\tif (!this._readFileSync) this.readFileSync = null;\n\n\t\tif (this.fileSystem.readJson) {\n\t\t\tthis._readJson = this.fileSystem.readJson.bind(this.fileSystem);\n\t\t} else if (this.readFile) {\n\t\t\tthis._readJson = (path, callback) => {\n\t\t\t\tthis.readFile(path, (err, buffer) => {\n\t\t\t\t\tif (err) return callback(err);\n\t\t\t\t\tlet data;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata = JSON.parse(buffer.toString(\"utf-8\"));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\treturn callback(e);\n\t\t\t\t\t}\n\t\t\t\t\tcallback(null, data);\n\t\t\t\t});\n\t\t\t};\n\t\t} else {\n\t\t\tthis.readJson = null;\n\t\t}\n\t\tif (this.fileSystem.readJsonSync) {\n\t\t\tthis._readJsonSync = this.fileSystem.readJsonSync.bind(this.fileSystem);\n\t\t} else if (this.readFileSync) {\n\t\t\tthis._readJsonSync = path => {\n\t\t\t\tconst buffer = this.readFileSync(path);\n\t\t\t\tconst data = JSON.parse(buffer.toString(\"utf-8\"));\n\t\t\t\treturn data;\n\t\t\t};\n\t\t} else {\n\t\t\tthis.readJsonSync = null;\n\t\t}\n\n\t\tthis._readlink = this.fileSystem.readlink\n\t\t\t? this.fileSystem.readlink.bind(this.fileSystem)\n\t\t\t: null;\n\t\tif (!this._readlink) this.readlink = null;\n\n\t\tthis._readlinkSync = this.fileSystem.readlinkSync\n\t\t\t? this.fileSystem.readlinkSync.bind(this.fileSystem)\n\t\t\t: null;\n\t\tif (!this._readlinkSync) this.readlinkSync = null;\n\t}\n\n\tstat(path, callback) {\n\t\tthis._statStorage.provide(path, this._stat, callback);\n\t}\n\n\treaddir(path, callback) {\n\t\tthis._readdirStorage.provide(path, this._readdir, callback);\n\t}\n\n\treadFile(path, callback) {\n\t\tthis._readFileStorage.provide(path, this._readFile, callback);\n\t}\n\n\treadJson(path, callback) {\n\t\tthis._readJsonStorage.provide(path, this._readJson, callback);\n\t}\n\n\treadlink(path, callback) {\n\t\tthis._readlinkStorage.provide(path, this._readlink, callback);\n\t}\n\n\tstatSync(path) {\n\t\treturn this._statStorage.provideSync(path, this._statSync);\n\t}\n\n\treaddirSync(path) {\n\t\treturn this._readdirStorage.provideSync(path, this._readdirSync);\n\t}\n\n\treadFileSync(path) {\n\t\treturn this._readFileStorage.provideSync(path, this._readFileSync);\n\t}\n\n\treadJsonSync(path) {\n\t\treturn this._readJsonStorage.provideSync(path, this._readJsonSync);\n\t}\n\n\treadlinkSync(path) {\n\t\treturn this._readlinkStorage.provideSync(path, this._readlinkSync);\n\t}\n\n\tpurge(what) {\n\t\tthis._statStorage.purge(what);\n\t\tthis._readdirStorage.purge(what);\n\t\tthis._readFileStorage.purge(what);\n\t\tthis._readlinkStorage.purge(what);\n\t\tthis._readJsonStorage.purge(what);\n\t}\n};\n"]},"metadata":{},"sourceType":"script"}