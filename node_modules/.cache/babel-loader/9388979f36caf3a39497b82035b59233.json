{"ast":null,"code":"var fs = require('fs');\n\nvar path = require('path');\n\nvar util = require('util');\n\nfunction Y18N(opts) {\n  // configurable options.\n  opts = opts || {};\n  this.directory = opts.directory || './locales';\n  this.updateFiles = typeof opts.updateFiles === 'boolean' ? opts.updateFiles : true;\n  this.locale = opts.locale || 'en';\n  this.fallbackToLanguage = typeof opts.fallbackToLanguage === 'boolean' ? opts.fallbackToLanguage : true; // internal stuff.\n\n  this.cache = Object.create(null);\n  this.writeQueue = [];\n}\n\nY18N.prototype.__ = function () {\n  if (typeof arguments[0] !== 'string') {\n    return this._taggedLiteral.apply(this, arguments);\n  }\n\n  var args = Array.prototype.slice.call(arguments);\n  var str = args.shift();\n\n  var cb = function () {}; // start with noop.\n\n\n  if (typeof args[args.length - 1] === 'function') cb = args.pop();\n\n  cb = cb || function () {}; // noop.\n\n\n  if (!this.cache[this.locale]) this._readLocaleFile(); // we've observed a new string, update the language file.\n\n  if (!this.cache[this.locale][str] && this.updateFiles) {\n    this.cache[this.locale][str] = str; // include the current directory and locale,\n    // since these values could change before the\n    // write is performed.\n\n    this._enqueueWrite([this.directory, this.locale, cb]);\n  } else {\n    cb();\n  }\n\n  return util.format.apply(util, [this.cache[this.locale][str] || str].concat(args));\n};\n\nY18N.prototype._taggedLiteral = function (parts) {\n  var args = arguments;\n  var str = '';\n  parts.forEach(function (part, i) {\n    var arg = args[i + 1];\n    str += part;\n\n    if (typeof arg !== 'undefined') {\n      str += '%s';\n    }\n  });\n  return this.__.apply(null, [str].concat([].slice.call(arguments, 1)));\n};\n\nY18N.prototype._enqueueWrite = function (work) {\n  this.writeQueue.push(work);\n  if (this.writeQueue.length === 1) this._processWriteQueue();\n};\n\nY18N.prototype._processWriteQueue = function () {\n  var _this = this;\n\n  var work = this.writeQueue[0]; // destructure the enqueued work.\n\n  var directory = work[0];\n  var locale = work[1];\n  var cb = work[2];\n\n  var languageFile = this._resolveLocaleFile(directory, locale);\n\n  var serializedLocale = JSON.stringify(this.cache[locale], null, 2);\n  fs.writeFile(languageFile, serializedLocale, 'utf-8', function (err) {\n    _this.writeQueue.shift();\n\n    if (_this.writeQueue.length > 0) _this._processWriteQueue();\n    cb(err);\n  });\n};\n\nY18N.prototype._readLocaleFile = function () {\n  var localeLookup = {};\n\n  var languageFile = this._resolveLocaleFile(this.directory, this.locale);\n\n  try {\n    localeLookup = JSON.parse(fs.readFileSync(languageFile, 'utf-8'));\n  } catch (err) {\n    if (err instanceof SyntaxError) {\n      err.message = 'syntax error in ' + languageFile;\n    }\n\n    if (err.code === 'ENOENT') localeLookup = {};else throw err;\n  }\n\n  this.cache[this.locale] = localeLookup;\n};\n\nY18N.prototype._resolveLocaleFile = function (directory, locale) {\n  var file = path.resolve(directory, './', locale + '.json');\n\n  if (this.fallbackToLanguage && !this._fileExistsSync(file) && ~locale.lastIndexOf('_')) {\n    // attempt fallback to language only\n    var languageFile = path.resolve(directory, './', locale.split('_')[0] + '.json');\n    if (this._fileExistsSync(languageFile)) file = languageFile;\n  }\n\n  return file;\n}; // this only exists because fs.existsSync() \"will be deprecated\"\n// see https://nodejs.org/api/fs.html#fs_fs_existssync_path\n\n\nY18N.prototype._fileExistsSync = function (file) {\n  try {\n    return fs.statSync(file).isFile();\n  } catch (err) {\n    return false;\n  }\n};\n\nY18N.prototype.__n = function () {\n  var args = Array.prototype.slice.call(arguments);\n  var singular = args.shift();\n  var plural = args.shift();\n  var quantity = args.shift();\n\n  var cb = function () {}; // start with noop.\n\n\n  if (typeof args[args.length - 1] === 'function') cb = args.pop();\n  if (!this.cache[this.locale]) this._readLocaleFile();\n  var str = quantity === 1 ? singular : plural;\n\n  if (this.cache[this.locale][singular]) {\n    str = this.cache[this.locale][singular][quantity === 1 ? 'one' : 'other'];\n  } // we've observed a new string, update the language file.\n\n\n  if (!this.cache[this.locale][singular] && this.updateFiles) {\n    this.cache[this.locale][singular] = {\n      one: singular,\n      other: plural\n    }; // include the current directory and locale,\n    // since these values could change before the\n    // write is performed.\n\n    this._enqueueWrite([this.directory, this.locale, cb]);\n  } else {\n    cb();\n  } // if a %d placeholder is provided, add quantity\n  // to the arguments expanded by util.format.\n\n\n  var values = [str];\n  if (~str.indexOf('%d')) values.push(quantity);\n  return util.format.apply(util, values.concat(args));\n};\n\nY18N.prototype.setLocale = function (locale) {\n  this.locale = locale;\n};\n\nY18N.prototype.getLocale = function () {\n  return this.locale;\n};\n\nY18N.prototype.updateLocale = function (obj) {\n  if (!this.cache[this.locale]) this._readLocaleFile();\n\n  for (var key in obj) {\n    this.cache[this.locale][key] = obj[key];\n  }\n};\n\nmodule.exports = function (opts) {\n  var y18n = new Y18N(opts); // bind all functions to y18n, so that\n  // they can be used in isolation.\n\n  for (var key in y18n) {\n    if (typeof y18n[key] === 'function') {\n      y18n[key] = y18n[key].bind(y18n);\n    }\n  }\n\n  return y18n;\n};","map":{"version":3,"sources":["/Users/hamzakhan/Documents/twitter-react/twitter/node_modules/y18n/index.js"],"names":["fs","require","path","util","Y18N","opts","directory","updateFiles","locale","fallbackToLanguage","cache","Object","create","writeQueue","prototype","__","arguments","_taggedLiteral","apply","args","Array","slice","call","str","shift","cb","length","pop","_readLocaleFile","_enqueueWrite","format","concat","parts","forEach","part","i","arg","work","push","_processWriteQueue","_this","languageFile","_resolveLocaleFile","serializedLocale","JSON","stringify","writeFile","err","localeLookup","parse","readFileSync","SyntaxError","message","code","file","resolve","_fileExistsSync","lastIndexOf","split","statSync","isFile","__n","singular","plural","quantity","one","other","values","indexOf","setLocale","getLocale","updateLocale","obj","key","module","exports","y18n","bind"],"mappings":"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","sourcesContent":["var fs = require('fs')\nvar path = require('path')\nvar util = require('util')\n\nfunction Y18N (opts) {\n  // configurable options.\n  opts = opts || {}\n  this.directory = opts.directory || './locales'\n  this.updateFiles = typeof opts.updateFiles === 'boolean' ? opts.updateFiles : true\n  this.locale = opts.locale || 'en'\n  this.fallbackToLanguage = typeof opts.fallbackToLanguage === 'boolean' ? opts.fallbackToLanguage : true\n\n  // internal stuff.\n  this.cache = Object.create(null)\n  this.writeQueue = []\n}\n\nY18N.prototype.__ = function () {\n  if (typeof arguments[0] !== 'string') {\n    return this._taggedLiteral.apply(this, arguments)\n  }\n  var args = Array.prototype.slice.call(arguments)\n  var str = args.shift()\n  var cb = function () {} // start with noop.\n\n  if (typeof args[args.length - 1] === 'function') cb = args.pop()\n  cb = cb || function () {} // noop.\n\n  if (!this.cache[this.locale]) this._readLocaleFile()\n\n  // we've observed a new string, update the language file.\n  if (!this.cache[this.locale][str] && this.updateFiles) {\n    this.cache[this.locale][str] = str\n\n    // include the current directory and locale,\n    // since these values could change before the\n    // write is performed.\n    this._enqueueWrite([this.directory, this.locale, cb])\n  } else {\n    cb()\n  }\n\n  return util.format.apply(util, [this.cache[this.locale][str] || str].concat(args))\n}\n\nY18N.prototype._taggedLiteral = function (parts) {\n  var args = arguments\n  var str = ''\n  parts.forEach(function (part, i) {\n    var arg = args[i + 1]\n    str += part\n    if (typeof arg !== 'undefined') {\n      str += '%s'\n    }\n  })\n  return this.__.apply(null, [str].concat([].slice.call(arguments, 1)))\n}\n\nY18N.prototype._enqueueWrite = function (work) {\n  this.writeQueue.push(work)\n  if (this.writeQueue.length === 1) this._processWriteQueue()\n}\n\nY18N.prototype._processWriteQueue = function () {\n  var _this = this\n  var work = this.writeQueue[0]\n\n  // destructure the enqueued work.\n  var directory = work[0]\n  var locale = work[1]\n  var cb = work[2]\n\n  var languageFile = this._resolveLocaleFile(directory, locale)\n  var serializedLocale = JSON.stringify(this.cache[locale], null, 2)\n\n  fs.writeFile(languageFile, serializedLocale, 'utf-8', function (err) {\n    _this.writeQueue.shift()\n    if (_this.writeQueue.length > 0) _this._processWriteQueue()\n    cb(err)\n  })\n}\n\nY18N.prototype._readLocaleFile = function () {\n  var localeLookup = {}\n  var languageFile = this._resolveLocaleFile(this.directory, this.locale)\n\n  try {\n    localeLookup = JSON.parse(fs.readFileSync(languageFile, 'utf-8'))\n  } catch (err) {\n    if (err instanceof SyntaxError) {\n      err.message = 'syntax error in ' + languageFile\n    }\n\n    if (err.code === 'ENOENT') localeLookup = {}\n    else throw err\n  }\n\n  this.cache[this.locale] = localeLookup\n}\n\nY18N.prototype._resolveLocaleFile = function (directory, locale) {\n  var file = path.resolve(directory, './', locale + '.json')\n  if (this.fallbackToLanguage && !this._fileExistsSync(file) && ~locale.lastIndexOf('_')) {\n    // attempt fallback to language only\n    var languageFile = path.resolve(directory, './', locale.split('_')[0] + '.json')\n    if (this._fileExistsSync(languageFile)) file = languageFile\n  }\n  return file\n}\n\n// this only exists because fs.existsSync() \"will be deprecated\"\n// see https://nodejs.org/api/fs.html#fs_fs_existssync_path\nY18N.prototype._fileExistsSync = function (file) {\n  try {\n    return fs.statSync(file).isFile()\n  } catch (err) {\n    return false\n  }\n}\n\nY18N.prototype.__n = function () {\n  var args = Array.prototype.slice.call(arguments)\n  var singular = args.shift()\n  var plural = args.shift()\n  var quantity = args.shift()\n\n  var cb = function () {} // start with noop.\n  if (typeof args[args.length - 1] === 'function') cb = args.pop()\n\n  if (!this.cache[this.locale]) this._readLocaleFile()\n\n  var str = quantity === 1 ? singular : plural\n  if (this.cache[this.locale][singular]) {\n    str = this.cache[this.locale][singular][quantity === 1 ? 'one' : 'other']\n  }\n\n  // we've observed a new string, update the language file.\n  if (!this.cache[this.locale][singular] && this.updateFiles) {\n    this.cache[this.locale][singular] = {\n      one: singular,\n      other: plural\n    }\n\n    // include the current directory and locale,\n    // since these values could change before the\n    // write is performed.\n    this._enqueueWrite([this.directory, this.locale, cb])\n  } else {\n    cb()\n  }\n\n  // if a %d placeholder is provided, add quantity\n  // to the arguments expanded by util.format.\n  var values = [str]\n  if (~str.indexOf('%d')) values.push(quantity)\n\n  return util.format.apply(util, values.concat(args))\n}\n\nY18N.prototype.setLocale = function (locale) {\n  this.locale = locale\n}\n\nY18N.prototype.getLocale = function () {\n  return this.locale\n}\n\nY18N.prototype.updateLocale = function (obj) {\n  if (!this.cache[this.locale]) this._readLocaleFile()\n\n  for (var key in obj) {\n    this.cache[this.locale][key] = obj[key]\n  }\n}\n\nmodule.exports = function (opts) {\n  var y18n = new Y18N(opts)\n\n  // bind all functions to y18n, so that\n  // they can be used in isolation.\n  for (var key in y18n) {\n    if (typeof y18n[key] === 'function') {\n      y18n[key] = y18n[key].bind(y18n)\n    }\n  }\n\n  return y18n\n}\n"]},"metadata":{},"sourceType":"script"}