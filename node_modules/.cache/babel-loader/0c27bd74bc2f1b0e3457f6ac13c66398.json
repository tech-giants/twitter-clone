{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst {\n  SyncBailHook\n} = require(\"tapable\");\n\nconst HarmonyImportSideEffectDependency = require(\"./HarmonyImportSideEffectDependency\");\n\nconst HarmonyImportSpecifierDependency = require(\"./HarmonyImportSpecifierDependency\");\n\nconst HarmonyAcceptImportDependency = require(\"./HarmonyAcceptImportDependency\");\n\nconst HarmonyAcceptDependency = require(\"./HarmonyAcceptDependency\");\n\nconst ConstDependency = require(\"./ConstDependency\");\n\nmodule.exports = class HarmonyImportDependencyParserPlugin {\n  constructor(moduleOptions) {\n    this.strictExportPresence = moduleOptions.strictExportPresence;\n    this.strictThisContextOnImports = moduleOptions.strictThisContextOnImports;\n  }\n\n  apply(parser) {\n    parser.hooks.import.tap(\"HarmonyImportDependencyParserPlugin\", (statement, source) => {\n      parser.state.lastHarmonyImportOrder = (parser.state.lastHarmonyImportOrder || 0) + 1;\n      const clearDep = new ConstDependency(\"\", statement.range);\n      clearDep.loc = statement.loc;\n      parser.state.module.addDependency(clearDep);\n      const sideEffectDep = new HarmonyImportSideEffectDependency(source, parser.state.module, parser.state.lastHarmonyImportOrder, parser.state.harmonyParserScope);\n      sideEffectDep.loc = statement.loc;\n      parser.state.module.addDependency(sideEffectDep);\n      return true;\n    });\n    parser.hooks.importSpecifier.tap(\"HarmonyImportDependencyParserPlugin\", (statement, source, id, name) => {\n      parser.scope.definitions.delete(name);\n      parser.scope.renames.set(name, \"imported var\");\n\n      if (!parser.state.harmonySpecifier) {\n        parser.state.harmonySpecifier = new Map();\n      }\n\n      parser.state.harmonySpecifier.set(name, {\n        source,\n        id,\n        sourceOrder: parser.state.lastHarmonyImportOrder\n      });\n      return true;\n    });\n    parser.hooks.expression.for(\"imported var\").tap(\"HarmonyImportDependencyParserPlugin\", expr => {\n      const name = expr.name;\n      const settings = parser.state.harmonySpecifier.get(name);\n      const dep = new HarmonyImportSpecifierDependency(settings.source, parser.state.module, settings.sourceOrder, parser.state.harmonyParserScope, settings.id, name, expr.range, this.strictExportPresence);\n      dep.shorthand = parser.scope.inShorthand;\n      dep.directImport = true;\n      dep.loc = expr.loc;\n      parser.state.module.addDependency(dep);\n      return true;\n    });\n    parser.hooks.expressionAnyMember.for(\"imported var\").tap(\"HarmonyImportDependencyParserPlugin\", expr => {\n      const name = expr.object.name;\n      const settings = parser.state.harmonySpecifier.get(name);\n      if (settings.id !== null) return false;\n      const dep = new HarmonyImportSpecifierDependency(settings.source, parser.state.module, settings.sourceOrder, parser.state.harmonyParserScope, expr.property.name || expr.property.value, name, expr.range, this.strictExportPresence);\n      dep.shorthand = parser.scope.inShorthand;\n      dep.directImport = false;\n      dep.loc = expr.loc;\n      parser.state.module.addDependency(dep);\n      return true;\n    });\n\n    if (this.strictThisContextOnImports) {\n      // only in case when we strictly follow the spec we need a special case here\n      parser.hooks.callAnyMember.for(\"imported var\").tap(\"HarmonyImportDependencyParserPlugin\", expr => {\n        if (expr.callee.type !== \"MemberExpression\") return;\n        if (expr.callee.object.type !== \"Identifier\") return;\n        const name = expr.callee.object.name;\n        const settings = parser.state.harmonySpecifier.get(name);\n        if (settings.id !== null) return false;\n        const dep = new HarmonyImportSpecifierDependency(settings.source, parser.state.module, settings.sourceOrder, parser.state.harmonyParserScope, expr.callee.property.name || expr.callee.property.value, name, expr.callee.range, this.strictExportPresence);\n        dep.shorthand = parser.scope.inShorthand;\n        dep.directImport = false;\n        dep.namespaceObjectAsContext = true;\n        dep.loc = expr.callee.loc;\n        parser.state.module.addDependency(dep);\n        if (expr.arguments) parser.walkExpressions(expr.arguments);\n        return true;\n      });\n    }\n\n    parser.hooks.call.for(\"imported var\").tap(\"HarmonyImportDependencyParserPlugin\", expr => {\n      const args = expr.arguments;\n      const fullExpr = expr;\n      expr = expr.callee;\n      if (expr.type !== \"Identifier\") return;\n      const name = expr.name;\n      const settings = parser.state.harmonySpecifier.get(name);\n      const dep = new HarmonyImportSpecifierDependency(settings.source, parser.state.module, settings.sourceOrder, parser.state.harmonyParserScope, settings.id, name, expr.range, this.strictExportPresence);\n      dep.directImport = true;\n      dep.callArgs = args;\n      dep.call = fullExpr;\n      dep.loc = expr.loc;\n      parser.state.module.addDependency(dep);\n      if (args) parser.walkExpressions(args);\n      return true;\n    }); // TODO webpack 5: refactor this, no custom hooks\n\n    if (!parser.hooks.hotAcceptCallback) {\n      parser.hooks.hotAcceptCallback = new SyncBailHook([\"expression\", \"requests\"]);\n    }\n\n    if (!parser.hooks.hotAcceptWithoutCallback) {\n      parser.hooks.hotAcceptWithoutCallback = new SyncBailHook([\"expression\", \"requests\"]);\n    }\n\n    parser.hooks.hotAcceptCallback.tap(\"HarmonyImportDependencyParserPlugin\", (expr, requests) => {\n      const harmonyParserScope = parser.state.harmonyParserScope;\n\n      if (!harmonyParserScope) {\n        // This is not a harmony module, skip it\n        return;\n      }\n\n      const dependencies = requests.map(request => {\n        const dep = new HarmonyAcceptImportDependency(request, parser.state.module, harmonyParserScope);\n        dep.loc = expr.loc;\n        parser.state.module.addDependency(dep);\n        return dep;\n      });\n\n      if (dependencies.length > 0) {\n        const dep = new HarmonyAcceptDependency(expr.range, dependencies, true);\n        dep.loc = expr.loc;\n        parser.state.module.addDependency(dep);\n      }\n    });\n    parser.hooks.hotAcceptWithoutCallback.tap(\"HarmonyImportDependencyParserPlugin\", (expr, requests) => {\n      const dependencies = requests.map(request => {\n        const dep = new HarmonyAcceptImportDependency(request, parser.state.module, parser.state.harmonyParserScope);\n        dep.loc = expr.loc;\n        parser.state.module.addDependency(dep);\n        return dep;\n      });\n\n      if (dependencies.length > 0) {\n        const dep = new HarmonyAcceptDependency(expr.range, dependencies, false);\n        dep.loc = expr.loc;\n        parser.state.module.addDependency(dep);\n      }\n    });\n  }\n\n};","map":{"version":3,"sources":["/Users/hamzakhan/Documents/twitter-react/twitter/node_modules/webpack/lib/dependencies/HarmonyImportDependencyParserPlugin.js"],"names":["SyncBailHook","require","HarmonyImportSideEffectDependency","HarmonyImportSpecifierDependency","HarmonyAcceptImportDependency","HarmonyAcceptDependency","ConstDependency","module","exports","HarmonyImportDependencyParserPlugin","constructor","moduleOptions","strictExportPresence","strictThisContextOnImports","apply","parser","hooks","import","tap","statement","source","state","lastHarmonyImportOrder","clearDep","range","loc","addDependency","sideEffectDep","harmonyParserScope","importSpecifier","id","name","scope","definitions","delete","renames","set","harmonySpecifier","Map","sourceOrder","expression","for","expr","settings","get","dep","shorthand","inShorthand","directImport","expressionAnyMember","object","property","value","callAnyMember","callee","type","namespaceObjectAsContext","arguments","walkExpressions","call","args","fullExpr","callArgs","hotAcceptCallback","hotAcceptWithoutCallback","requests","dependencies","map","request","length"],"mappings":"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","sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst { SyncBailHook } = require(\"tapable\");\nconst HarmonyImportSideEffectDependency = require(\"./HarmonyImportSideEffectDependency\");\nconst HarmonyImportSpecifierDependency = require(\"./HarmonyImportSpecifierDependency\");\nconst HarmonyAcceptImportDependency = require(\"./HarmonyAcceptImportDependency\");\nconst HarmonyAcceptDependency = require(\"./HarmonyAcceptDependency\");\nconst ConstDependency = require(\"./ConstDependency\");\n\nmodule.exports = class HarmonyImportDependencyParserPlugin {\n\tconstructor(moduleOptions) {\n\t\tthis.strictExportPresence = moduleOptions.strictExportPresence;\n\t\tthis.strictThisContextOnImports = moduleOptions.strictThisContextOnImports;\n\t}\n\n\tapply(parser) {\n\t\tparser.hooks.import.tap(\n\t\t\t\"HarmonyImportDependencyParserPlugin\",\n\t\t\t(statement, source) => {\n\t\t\t\tparser.state.lastHarmonyImportOrder =\n\t\t\t\t\t(parser.state.lastHarmonyImportOrder || 0) + 1;\n\t\t\t\tconst clearDep = new ConstDependency(\"\", statement.range);\n\t\t\t\tclearDep.loc = statement.loc;\n\t\t\t\tparser.state.module.addDependency(clearDep);\n\t\t\t\tconst sideEffectDep = new HarmonyImportSideEffectDependency(\n\t\t\t\t\tsource,\n\t\t\t\t\tparser.state.module,\n\t\t\t\t\tparser.state.lastHarmonyImportOrder,\n\t\t\t\t\tparser.state.harmonyParserScope\n\t\t\t\t);\n\t\t\t\tsideEffectDep.loc = statement.loc;\n\t\t\t\tparser.state.module.addDependency(sideEffectDep);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t);\n\t\tparser.hooks.importSpecifier.tap(\n\t\t\t\"HarmonyImportDependencyParserPlugin\",\n\t\t\t(statement, source, id, name) => {\n\t\t\t\tparser.scope.definitions.delete(name);\n\t\t\t\tparser.scope.renames.set(name, \"imported var\");\n\t\t\t\tif (!parser.state.harmonySpecifier) {\n\t\t\t\t\tparser.state.harmonySpecifier = new Map();\n\t\t\t\t}\n\t\t\t\tparser.state.harmonySpecifier.set(name, {\n\t\t\t\t\tsource,\n\t\t\t\t\tid,\n\t\t\t\t\tsourceOrder: parser.state.lastHarmonyImportOrder\n\t\t\t\t});\n\t\t\t\treturn true;\n\t\t\t}\n\t\t);\n\t\tparser.hooks.expression\n\t\t\t.for(\"imported var\")\n\t\t\t.tap(\"HarmonyImportDependencyParserPlugin\", expr => {\n\t\t\t\tconst name = expr.name;\n\t\t\t\tconst settings = parser.state.harmonySpecifier.get(name);\n\t\t\t\tconst dep = new HarmonyImportSpecifierDependency(\n\t\t\t\t\tsettings.source,\n\t\t\t\t\tparser.state.module,\n\t\t\t\t\tsettings.sourceOrder,\n\t\t\t\t\tparser.state.harmonyParserScope,\n\t\t\t\t\tsettings.id,\n\t\t\t\t\tname,\n\t\t\t\t\texpr.range,\n\t\t\t\t\tthis.strictExportPresence\n\t\t\t\t);\n\t\t\t\tdep.shorthand = parser.scope.inShorthand;\n\t\t\t\tdep.directImport = true;\n\t\t\t\tdep.loc = expr.loc;\n\t\t\t\tparser.state.module.addDependency(dep);\n\t\t\t\treturn true;\n\t\t\t});\n\t\tparser.hooks.expressionAnyMember\n\t\t\t.for(\"imported var\")\n\t\t\t.tap(\"HarmonyImportDependencyParserPlugin\", expr => {\n\t\t\t\tconst name = expr.object.name;\n\t\t\t\tconst settings = parser.state.harmonySpecifier.get(name);\n\t\t\t\tif (settings.id !== null) return false;\n\t\t\t\tconst dep = new HarmonyImportSpecifierDependency(\n\t\t\t\t\tsettings.source,\n\t\t\t\t\tparser.state.module,\n\t\t\t\t\tsettings.sourceOrder,\n\t\t\t\t\tparser.state.harmonyParserScope,\n\t\t\t\t\texpr.property.name || expr.property.value,\n\t\t\t\t\tname,\n\t\t\t\t\texpr.range,\n\t\t\t\t\tthis.strictExportPresence\n\t\t\t\t);\n\t\t\t\tdep.shorthand = parser.scope.inShorthand;\n\t\t\t\tdep.directImport = false;\n\t\t\t\tdep.loc = expr.loc;\n\t\t\t\tparser.state.module.addDependency(dep);\n\t\t\t\treturn true;\n\t\t\t});\n\t\tif (this.strictThisContextOnImports) {\n\t\t\t// only in case when we strictly follow the spec we need a special case here\n\t\t\tparser.hooks.callAnyMember\n\t\t\t\t.for(\"imported var\")\n\t\t\t\t.tap(\"HarmonyImportDependencyParserPlugin\", expr => {\n\t\t\t\t\tif (expr.callee.type !== \"MemberExpression\") return;\n\t\t\t\t\tif (expr.callee.object.type !== \"Identifier\") return;\n\t\t\t\t\tconst name = expr.callee.object.name;\n\t\t\t\t\tconst settings = parser.state.harmonySpecifier.get(name);\n\t\t\t\t\tif (settings.id !== null) return false;\n\t\t\t\t\tconst dep = new HarmonyImportSpecifierDependency(\n\t\t\t\t\t\tsettings.source,\n\t\t\t\t\t\tparser.state.module,\n\t\t\t\t\t\tsettings.sourceOrder,\n\t\t\t\t\t\tparser.state.harmonyParserScope,\n\t\t\t\t\t\texpr.callee.property.name || expr.callee.property.value,\n\t\t\t\t\t\tname,\n\t\t\t\t\t\texpr.callee.range,\n\t\t\t\t\t\tthis.strictExportPresence\n\t\t\t\t\t);\n\t\t\t\t\tdep.shorthand = parser.scope.inShorthand;\n\t\t\t\t\tdep.directImport = false;\n\t\t\t\t\tdep.namespaceObjectAsContext = true;\n\t\t\t\t\tdep.loc = expr.callee.loc;\n\t\t\t\t\tparser.state.module.addDependency(dep);\n\t\t\t\t\tif (expr.arguments) parser.walkExpressions(expr.arguments);\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\t\t}\n\t\tparser.hooks.call\n\t\t\t.for(\"imported var\")\n\t\t\t.tap(\"HarmonyImportDependencyParserPlugin\", expr => {\n\t\t\t\tconst args = expr.arguments;\n\t\t\t\tconst fullExpr = expr;\n\t\t\t\texpr = expr.callee;\n\t\t\t\tif (expr.type !== \"Identifier\") return;\n\t\t\t\tconst name = expr.name;\n\t\t\t\tconst settings = parser.state.harmonySpecifier.get(name);\n\t\t\t\tconst dep = new HarmonyImportSpecifierDependency(\n\t\t\t\t\tsettings.source,\n\t\t\t\t\tparser.state.module,\n\t\t\t\t\tsettings.sourceOrder,\n\t\t\t\t\tparser.state.harmonyParserScope,\n\t\t\t\t\tsettings.id,\n\t\t\t\t\tname,\n\t\t\t\t\texpr.range,\n\t\t\t\t\tthis.strictExportPresence\n\t\t\t\t);\n\t\t\t\tdep.directImport = true;\n\t\t\t\tdep.callArgs = args;\n\t\t\t\tdep.call = fullExpr;\n\t\t\t\tdep.loc = expr.loc;\n\t\t\t\tparser.state.module.addDependency(dep);\n\t\t\t\tif (args) parser.walkExpressions(args);\n\t\t\t\treturn true;\n\t\t\t});\n\t\t// TODO webpack 5: refactor this, no custom hooks\n\t\tif (!parser.hooks.hotAcceptCallback) {\n\t\t\tparser.hooks.hotAcceptCallback = new SyncBailHook([\n\t\t\t\t\"expression\",\n\t\t\t\t\"requests\"\n\t\t\t]);\n\t\t}\n\t\tif (!parser.hooks.hotAcceptWithoutCallback) {\n\t\t\tparser.hooks.hotAcceptWithoutCallback = new SyncBailHook([\n\t\t\t\t\"expression\",\n\t\t\t\t\"requests\"\n\t\t\t]);\n\t\t}\n\t\tparser.hooks.hotAcceptCallback.tap(\n\t\t\t\"HarmonyImportDependencyParserPlugin\",\n\t\t\t(expr, requests) => {\n\t\t\t\tconst harmonyParserScope = parser.state.harmonyParserScope;\n\t\t\t\tif (!harmonyParserScope) {\n\t\t\t\t\t// This is not a harmony module, skip it\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst dependencies = requests.map(request => {\n\t\t\t\t\tconst dep = new HarmonyAcceptImportDependency(\n\t\t\t\t\t\trequest,\n\t\t\t\t\t\tparser.state.module,\n\t\t\t\t\t\tharmonyParserScope\n\t\t\t\t\t);\n\t\t\t\t\tdep.loc = expr.loc;\n\t\t\t\t\tparser.state.module.addDependency(dep);\n\t\t\t\t\treturn dep;\n\t\t\t\t});\n\t\t\t\tif (dependencies.length > 0) {\n\t\t\t\t\tconst dep = new HarmonyAcceptDependency(\n\t\t\t\t\t\texpr.range,\n\t\t\t\t\t\tdependencies,\n\t\t\t\t\t\ttrue\n\t\t\t\t\t);\n\t\t\t\t\tdep.loc = expr.loc;\n\t\t\t\t\tparser.state.module.addDependency(dep);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tparser.hooks.hotAcceptWithoutCallback.tap(\n\t\t\t\"HarmonyImportDependencyParserPlugin\",\n\t\t\t(expr, requests) => {\n\t\t\t\tconst dependencies = requests.map(request => {\n\t\t\t\t\tconst dep = new HarmonyAcceptImportDependency(\n\t\t\t\t\t\trequest,\n\t\t\t\t\t\tparser.state.module,\n\t\t\t\t\t\tparser.state.harmonyParserScope\n\t\t\t\t\t);\n\t\t\t\t\tdep.loc = expr.loc;\n\t\t\t\t\tparser.state.module.addDependency(dep);\n\t\t\t\t\treturn dep;\n\t\t\t\t});\n\t\t\t\tif (dependencies.length > 0) {\n\t\t\t\t\tconst dep = new HarmonyAcceptDependency(\n\t\t\t\t\t\texpr.range,\n\t\t\t\t\t\tdependencies,\n\t\t\t\t\t\tfalse\n\t\t\t\t\t);\n\t\t\t\t\tdep.loc = expr.loc;\n\t\t\t\t\tparser.state.module.addDependency(dep);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n};\n"]},"metadata":{},"sourceType":"script"}