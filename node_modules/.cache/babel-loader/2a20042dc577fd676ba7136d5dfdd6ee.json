{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\nvar fs = require(\"fs\");\n\nvar readFile = fs.readFile.bind(fs);\n\nvar loadLoader = require(\"./loadLoader\");\n\nfunction utf8BufferToString(buf) {\n  var str = buf.toString(\"utf-8\");\n\n  if (str.charCodeAt(0) === 0xFEFF) {\n    return str.substr(1);\n  } else {\n    return str;\n  }\n}\n\nfunction splitQuery(req) {\n  var i = req.indexOf(\"?\");\n  if (i < 0) return [req, \"\"];\n  return [req.substr(0, i), req.substr(i)];\n}\n\nfunction dirname(path) {\n  if (path === \"/\") return \"/\";\n  var i = path.lastIndexOf(\"/\");\n  var j = path.lastIndexOf(\"\\\\\");\n  var i2 = path.indexOf(\"/\");\n  var j2 = path.indexOf(\"\\\\\");\n  var idx = i > j ? i : j;\n  var idx2 = i > j ? i2 : j2;\n  if (idx < 0) return path;\n  if (idx === idx2) return path.substr(0, idx + 1);\n  return path.substr(0, idx);\n}\n\nfunction createLoaderObject(loader) {\n  var obj = {\n    path: null,\n    query: null,\n    options: null,\n    ident: null,\n    normal: null,\n    pitch: null,\n    raw: null,\n    data: null,\n    pitchExecuted: false,\n    normalExecuted: false\n  };\n  Object.defineProperty(obj, \"request\", {\n    enumerable: true,\n    get: function () {\n      return obj.path + obj.query;\n    },\n    set: function (value) {\n      if (typeof value === \"string\") {\n        var splittedRequest = splitQuery(value);\n        obj.path = splittedRequest[0];\n        obj.query = splittedRequest[1];\n        obj.options = undefined;\n        obj.ident = undefined;\n      } else {\n        if (!value.loader) throw new Error(\"request should be a string or object with loader and object (\" + JSON.stringify(value) + \")\");\n        obj.path = value.loader;\n        obj.options = value.options;\n        obj.ident = value.ident;\n        if (obj.options === null) obj.query = \"\";else if (obj.options === undefined) obj.query = \"\";else if (typeof obj.options === \"string\") obj.query = \"?\" + obj.options;else if (obj.ident) obj.query = \"??\" + obj.ident;else if (typeof obj.options === \"object\" && obj.options.ident) obj.query = \"??\" + obj.options.ident;else obj.query = \"?\" + JSON.stringify(obj.options);\n      }\n    }\n  });\n  obj.request = loader;\n\n  if (Object.preventExtensions) {\n    Object.preventExtensions(obj);\n  }\n\n  return obj;\n}\n\nfunction runSyncOrAsync(fn, context, args, callback) {\n  var isSync = true;\n  var isDone = false;\n  var isError = false; // internal error\n\n  var reportedError = false;\n\n  context.async = function async() {\n    if (isDone) {\n      if (reportedError) return; // ignore\n\n      throw new Error(\"async(): The callback was already called.\");\n    }\n\n    isSync = false;\n    return innerCallback;\n  };\n\n  var innerCallback = context.callback = function () {\n    if (isDone) {\n      if (reportedError) return; // ignore\n\n      throw new Error(\"callback(): The callback was already called.\");\n    }\n\n    isDone = true;\n    isSync = false;\n\n    try {\n      callback.apply(null, arguments);\n    } catch (e) {\n      isError = true;\n      throw e;\n    }\n  };\n\n  try {\n    var result = function LOADER_EXECUTION() {\n      return fn.apply(context, args);\n    }();\n\n    if (isSync) {\n      isDone = true;\n      if (result === undefined) return callback();\n\n      if (result && typeof result === \"object\" && typeof result.then === \"function\") {\n        return result.then(function (r) {\n          callback(null, r);\n        }, callback);\n      }\n\n      return callback(null, result);\n    }\n  } catch (e) {\n    if (isError) throw e;\n\n    if (isDone) {\n      // loader is already \"done\", so we cannot use the callback function\n      // for better debugging we print the error on the console\n      if (typeof e === \"object\" && e.stack) console.error(e.stack);else console.error(e);\n      return;\n    }\n\n    isDone = true;\n    reportedError = true;\n    callback(e);\n  }\n}\n\nfunction convertArgs(args, raw) {\n  if (!raw && Buffer.isBuffer(args[0])) args[0] = utf8BufferToString(args[0]);else if (raw && typeof args[0] === \"string\") args[0] = new Buffer(args[0], \"utf-8\"); // eslint-disable-line\n}\n\nfunction iteratePitchingLoaders(options, loaderContext, callback) {\n  // abort after last loader\n  if (loaderContext.loaderIndex >= loaderContext.loaders.length) return processResource(options, loaderContext, callback);\n  var currentLoaderObject = loaderContext.loaders[loaderContext.loaderIndex]; // iterate\n\n  if (currentLoaderObject.pitchExecuted) {\n    loaderContext.loaderIndex++;\n    return iteratePitchingLoaders(options, loaderContext, callback);\n  } // load loader module\n\n\n  loadLoader(currentLoaderObject, function (err) {\n    if (err) {\n      loaderContext.cacheable(false);\n      return callback(err);\n    }\n\n    var fn = currentLoaderObject.pitch;\n    currentLoaderObject.pitchExecuted = true;\n    if (!fn) return iteratePitchingLoaders(options, loaderContext, callback);\n    runSyncOrAsync(fn, loaderContext, [loaderContext.remainingRequest, loaderContext.previousRequest, currentLoaderObject.data = {}], function (err) {\n      if (err) return callback(err);\n      var args = Array.prototype.slice.call(arguments, 1);\n\n      if (args.length > 0) {\n        loaderContext.loaderIndex--;\n        iterateNormalLoaders(options, loaderContext, args, callback);\n      } else {\n        iteratePitchingLoaders(options, loaderContext, callback);\n      }\n    });\n  });\n}\n\nfunction processResource(options, loaderContext, callback) {\n  // set loader index to last loader\n  loaderContext.loaderIndex = loaderContext.loaders.length - 1;\n  var resourcePath = loaderContext.resourcePath;\n\n  if (resourcePath) {\n    loaderContext.addDependency(resourcePath);\n    options.readResource(resourcePath, function (err, buffer) {\n      if (err) return callback(err);\n      options.resourceBuffer = buffer;\n      iterateNormalLoaders(options, loaderContext, [buffer], callback);\n    });\n  } else {\n    iterateNormalLoaders(options, loaderContext, [null], callback);\n  }\n}\n\nfunction iterateNormalLoaders(options, loaderContext, args, callback) {\n  if (loaderContext.loaderIndex < 0) return callback(null, args);\n  var currentLoaderObject = loaderContext.loaders[loaderContext.loaderIndex]; // iterate\n\n  if (currentLoaderObject.normalExecuted) {\n    loaderContext.loaderIndex--;\n    return iterateNormalLoaders(options, loaderContext, args, callback);\n  }\n\n  var fn = currentLoaderObject.normal;\n  currentLoaderObject.normalExecuted = true;\n\n  if (!fn) {\n    return iterateNormalLoaders(options, loaderContext, args, callback);\n  }\n\n  convertArgs(args, currentLoaderObject.raw);\n  runSyncOrAsync(fn, loaderContext, args, function (err) {\n    if (err) return callback(err);\n    var args = Array.prototype.slice.call(arguments, 1);\n    iterateNormalLoaders(options, loaderContext, args, callback);\n  });\n}\n\nexports.getContext = function getContext(resource) {\n  var splitted = splitQuery(resource);\n  return dirname(splitted[0]);\n};\n\nexports.runLoaders = function runLoaders(options, callback) {\n  // read options\n  var resource = options.resource || \"\";\n  var loaders = options.loaders || [];\n  var loaderContext = options.context || {};\n  var readResource = options.readResource || readFile; //\n\n  var splittedResource = resource && splitQuery(resource);\n  var resourcePath = splittedResource ? splittedResource[0] : undefined;\n  var resourceQuery = splittedResource ? splittedResource[1] : undefined;\n  var contextDirectory = resourcePath ? dirname(resourcePath) : null; // execution state\n\n  var requestCacheable = true;\n  var fileDependencies = [];\n  var contextDependencies = []; // prepare loader objects\n\n  loaders = loaders.map(createLoaderObject);\n  loaderContext.context = contextDirectory;\n  loaderContext.loaderIndex = 0;\n  loaderContext.loaders = loaders;\n  loaderContext.resourcePath = resourcePath;\n  loaderContext.resourceQuery = resourceQuery;\n  loaderContext.async = null;\n  loaderContext.callback = null;\n\n  loaderContext.cacheable = function cacheable(flag) {\n    if (flag === false) {\n      requestCacheable = false;\n    }\n  };\n\n  loaderContext.dependency = loaderContext.addDependency = function addDependency(file) {\n    fileDependencies.push(file);\n  };\n\n  loaderContext.addContextDependency = function addContextDependency(context) {\n    contextDependencies.push(context);\n  };\n\n  loaderContext.getDependencies = function getDependencies() {\n    return fileDependencies.slice();\n  };\n\n  loaderContext.getContextDependencies = function getContextDependencies() {\n    return contextDependencies.slice();\n  };\n\n  loaderContext.clearDependencies = function clearDependencies() {\n    fileDependencies.length = 0;\n    contextDependencies.length = 0;\n    requestCacheable = true;\n  };\n\n  Object.defineProperty(loaderContext, \"resource\", {\n    enumerable: true,\n    get: function () {\n      if (loaderContext.resourcePath === undefined) return undefined;\n      return loaderContext.resourcePath + loaderContext.resourceQuery;\n    },\n    set: function (value) {\n      var splittedResource = value && splitQuery(value);\n      loaderContext.resourcePath = splittedResource ? splittedResource[0] : undefined;\n      loaderContext.resourceQuery = splittedResource ? splittedResource[1] : undefined;\n    }\n  });\n  Object.defineProperty(loaderContext, \"request\", {\n    enumerable: true,\n    get: function () {\n      return loaderContext.loaders.map(function (o) {\n        return o.request;\n      }).concat(loaderContext.resource || \"\").join(\"!\");\n    }\n  });\n  Object.defineProperty(loaderContext, \"remainingRequest\", {\n    enumerable: true,\n    get: function () {\n      if (loaderContext.loaderIndex >= loaderContext.loaders.length - 1 && !loaderContext.resource) return \"\";\n      return loaderContext.loaders.slice(loaderContext.loaderIndex + 1).map(function (o) {\n        return o.request;\n      }).concat(loaderContext.resource || \"\").join(\"!\");\n    }\n  });\n  Object.defineProperty(loaderContext, \"currentRequest\", {\n    enumerable: true,\n    get: function () {\n      return loaderContext.loaders.slice(loaderContext.loaderIndex).map(function (o) {\n        return o.request;\n      }).concat(loaderContext.resource || \"\").join(\"!\");\n    }\n  });\n  Object.defineProperty(loaderContext, \"previousRequest\", {\n    enumerable: true,\n    get: function () {\n      return loaderContext.loaders.slice(0, loaderContext.loaderIndex).map(function (o) {\n        return o.request;\n      }).join(\"!\");\n    }\n  });\n  Object.defineProperty(loaderContext, \"query\", {\n    enumerable: true,\n    get: function () {\n      var entry = loaderContext.loaders[loaderContext.loaderIndex];\n      return entry.options && typeof entry.options === \"object\" ? entry.options : entry.query;\n    }\n  });\n  Object.defineProperty(loaderContext, \"data\", {\n    enumerable: true,\n    get: function () {\n      return loaderContext.loaders[loaderContext.loaderIndex].data;\n    }\n  }); // finish loader context\n\n  if (Object.preventExtensions) {\n    Object.preventExtensions(loaderContext);\n  }\n\n  var processOptions = {\n    resourceBuffer: null,\n    readResource: readResource\n  };\n  iteratePitchingLoaders(processOptions, loaderContext, function (err, result) {\n    if (err) {\n      return callback(err, {\n        cacheable: requestCacheable,\n        fileDependencies: fileDependencies,\n        contextDependencies: contextDependencies\n      });\n    }\n\n    callback(null, {\n      result: result,\n      resourceBuffer: processOptions.resourceBuffer,\n      cacheable: requestCacheable,\n      fileDependencies: fileDependencies,\n      contextDependencies: contextDependencies\n    });\n  });\n};","map":{"version":3,"sources":["/Users/hamzakhan/Documents/twitter-react/twitter/node_modules/loader-runner/lib/LoaderRunner.js"],"names":["fs","require","readFile","bind","loadLoader","utf8BufferToString","buf","str","toString","charCodeAt","substr","splitQuery","req","i","indexOf","dirname","path","lastIndexOf","j","i2","j2","idx","idx2","createLoaderObject","loader","obj","query","options","ident","normal","pitch","raw","data","pitchExecuted","normalExecuted","Object","defineProperty","enumerable","get","set","value","splittedRequest","undefined","Error","JSON","stringify","request","preventExtensions","runSyncOrAsync","fn","context","args","callback","isSync","isDone","isError","reportedError","async","innerCallback","apply","arguments","e","result","LOADER_EXECUTION","then","r","stack","console","error","convertArgs","Buffer","isBuffer","iteratePitchingLoaders","loaderContext","loaderIndex","loaders","length","processResource","currentLoaderObject","err","cacheable","remainingRequest","previousRequest","Array","prototype","slice","call","iterateNormalLoaders","resourcePath","addDependency","readResource","buffer","resourceBuffer","exports","getContext","resource","splitted","runLoaders","splittedResource","resourceQuery","contextDirectory","requestCacheable","fileDependencies","contextDependencies","map","flag","dependency","file","push","addContextDependency","getDependencies","getContextDependencies","clearDependencies","o","concat","join","entry","processOptions"],"mappings":"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","sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\nvar fs = require(\"fs\");\nvar readFile = fs.readFile.bind(fs);\nvar loadLoader = require(\"./loadLoader\");\n\nfunction utf8BufferToString(buf) {\n\tvar str = buf.toString(\"utf-8\");\n\tif(str.charCodeAt(0) === 0xFEFF) {\n\t\treturn str.substr(1);\n\t} else {\n\t\treturn str;\n\t}\n}\n\nfunction splitQuery(req) {\n\tvar i = req.indexOf(\"?\");\n\tif(i < 0) return [req, \"\"];\n\treturn [req.substr(0, i), req.substr(i)];\n}\n\nfunction dirname(path) {\n\tif(path === \"/\") return \"/\";\n\tvar i = path.lastIndexOf(\"/\");\n\tvar j = path.lastIndexOf(\"\\\\\");\n\tvar i2 = path.indexOf(\"/\");\n\tvar j2 = path.indexOf(\"\\\\\");\n\tvar idx = i > j ? i : j;\n\tvar idx2 = i > j ? i2 : j2;\n\tif(idx < 0) return path;\n\tif(idx === idx2) return path.substr(0, idx + 1);\n\treturn path.substr(0, idx);\n}\n\nfunction createLoaderObject(loader) {\n\tvar obj = {\n\t\tpath: null,\n\t\tquery: null,\n\t\toptions: null,\n\t\tident: null,\n\t\tnormal: null,\n\t\tpitch: null,\n\t\traw: null,\n\t\tdata: null,\n\t\tpitchExecuted: false,\n\t\tnormalExecuted: false\n\t};\n\tObject.defineProperty(obj, \"request\", {\n\t\tenumerable: true,\n\t\tget: function() {\n\t\t\treturn obj.path + obj.query;\n\t\t},\n\t\tset: function(value) {\n\t\t\tif(typeof value === \"string\") {\n\t\t\t\tvar splittedRequest = splitQuery(value);\n\t\t\t\tobj.path = splittedRequest[0];\n\t\t\t\tobj.query = splittedRequest[1];\n\t\t\t\tobj.options = undefined;\n\t\t\t\tobj.ident = undefined;\n\t\t\t} else {\n\t\t\t\tif(!value.loader)\n\t\t\t\t\tthrow new Error(\"request should be a string or object with loader and object (\" + JSON.stringify(value) + \")\");\n\t\t\t\tobj.path = value.loader;\n\t\t\t\tobj.options = value.options;\n\t\t\t\tobj.ident = value.ident;\n\t\t\t\tif(obj.options === null)\n\t\t\t\t\tobj.query = \"\";\n\t\t\t\telse if(obj.options === undefined)\n\t\t\t\t\tobj.query = \"\";\n\t\t\t\telse if(typeof obj.options === \"string\")\n\t\t\t\t\tobj.query = \"?\" + obj.options;\n\t\t\t\telse if(obj.ident)\n\t\t\t\t\tobj.query = \"??\" + obj.ident;\n\t\t\t\telse if(typeof obj.options === \"object\" && obj.options.ident)\n\t\t\t\t\tobj.query = \"??\" + obj.options.ident;\n\t\t\t\telse\n\t\t\t\t\tobj.query = \"?\" + JSON.stringify(obj.options);\n\t\t\t}\n\t\t}\n\t});\n\tobj.request = loader;\n\tif(Object.preventExtensions) {\n\t\tObject.preventExtensions(obj);\n\t}\n\treturn obj;\n}\n\nfunction runSyncOrAsync(fn, context, args, callback) {\n\tvar isSync = true;\n\tvar isDone = false;\n\tvar isError = false; // internal error\n\tvar reportedError = false;\n\tcontext.async = function async() {\n\t\tif(isDone) {\n\t\t\tif(reportedError) return; // ignore\n\t\t\tthrow new Error(\"async(): The callback was already called.\");\n\t\t}\n\t\tisSync = false;\n\t\treturn innerCallback;\n\t};\n\tvar innerCallback = context.callback = function() {\n\t\tif(isDone) {\n\t\t\tif(reportedError) return; // ignore\n\t\t\tthrow new Error(\"callback(): The callback was already called.\");\n\t\t}\n\t\tisDone = true;\n\t\tisSync = false;\n\t\ttry {\n\t\t\tcallback.apply(null, arguments);\n\t\t} catch(e) {\n\t\t\tisError = true;\n\t\t\tthrow e;\n\t\t}\n\t};\n\ttry {\n\t\tvar result = (function LOADER_EXECUTION() {\n\t\t\treturn fn.apply(context, args);\n\t\t}());\n\t\tif(isSync) {\n\t\t\tisDone = true;\n\t\t\tif(result === undefined)\n\t\t\t\treturn callback();\n\t\t\tif(result && typeof result === \"object\" && typeof result.then === \"function\") {\n\t\t\t\treturn result.then(function(r) {\n\t\t\t\t\tcallback(null, r);\n\t\t\t\t}, callback);\n\t\t\t}\n\t\t\treturn callback(null, result);\n\t\t}\n\t} catch(e) {\n\t\tif(isError) throw e;\n\t\tif(isDone) {\n\t\t\t// loader is already \"done\", so we cannot use the callback function\n\t\t\t// for better debugging we print the error on the console\n\t\t\tif(typeof e === \"object\" && e.stack) console.error(e.stack);\n\t\t\telse console.error(e);\n\t\t\treturn;\n\t\t}\n\t\tisDone = true;\n\t\treportedError = true;\n\t\tcallback(e);\n\t}\n\n}\n\nfunction convertArgs(args, raw) {\n\tif(!raw && Buffer.isBuffer(args[0]))\n\t\targs[0] = utf8BufferToString(args[0]);\n\telse if(raw && typeof args[0] === \"string\")\n\t\targs[0] = new Buffer(args[0], \"utf-8\"); // eslint-disable-line\n}\n\nfunction iteratePitchingLoaders(options, loaderContext, callback) {\n\t// abort after last loader\n\tif(loaderContext.loaderIndex >= loaderContext.loaders.length)\n\t\treturn processResource(options, loaderContext, callback);\n\n\tvar currentLoaderObject = loaderContext.loaders[loaderContext.loaderIndex];\n\n\t// iterate\n\tif(currentLoaderObject.pitchExecuted) {\n\t\tloaderContext.loaderIndex++;\n\t\treturn iteratePitchingLoaders(options, loaderContext, callback);\n\t}\n\n\t// load loader module\n\tloadLoader(currentLoaderObject, function(err) {\n\t\tif(err) {\n\t\t\tloaderContext.cacheable(false);\n\t\t\treturn callback(err);\n\t\t}\n\t\tvar fn = currentLoaderObject.pitch;\n\t\tcurrentLoaderObject.pitchExecuted = true;\n\t\tif(!fn) return iteratePitchingLoaders(options, loaderContext, callback);\n\n\t\trunSyncOrAsync(\n\t\t\tfn,\n\t\t\tloaderContext, [loaderContext.remainingRequest, loaderContext.previousRequest, currentLoaderObject.data = {}],\n\t\t\tfunction(err) {\n\t\t\t\tif(err) return callback(err);\n\t\t\t\tvar args = Array.prototype.slice.call(arguments, 1);\n\t\t\t\tif(args.length > 0) {\n\t\t\t\t\tloaderContext.loaderIndex--;\n\t\t\t\t\titerateNormalLoaders(options, loaderContext, args, callback);\n\t\t\t\t} else {\n\t\t\t\t\titeratePitchingLoaders(options, loaderContext, callback);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t});\n}\n\nfunction processResource(options, loaderContext, callback) {\n\t// set loader index to last loader\n\tloaderContext.loaderIndex = loaderContext.loaders.length - 1;\n\n\tvar resourcePath = loaderContext.resourcePath;\n\tif(resourcePath) {\n\t\tloaderContext.addDependency(resourcePath);\n\t\toptions.readResource(resourcePath, function(err, buffer) {\n\t\t\tif(err) return callback(err);\n\t\t\toptions.resourceBuffer = buffer;\n\t\t\titerateNormalLoaders(options, loaderContext, [buffer], callback);\n\t\t});\n\t} else {\n\t\titerateNormalLoaders(options, loaderContext, [null], callback);\n\t}\n}\n\nfunction iterateNormalLoaders(options, loaderContext, args, callback) {\n\tif(loaderContext.loaderIndex < 0)\n\t\treturn callback(null, args);\n\n\tvar currentLoaderObject = loaderContext.loaders[loaderContext.loaderIndex];\n\n\t// iterate\n\tif(currentLoaderObject.normalExecuted) {\n\t\tloaderContext.loaderIndex--;\n\t\treturn iterateNormalLoaders(options, loaderContext, args, callback);\n\t}\n\n\tvar fn = currentLoaderObject.normal;\n\tcurrentLoaderObject.normalExecuted = true;\n\tif(!fn) {\n\t\treturn iterateNormalLoaders(options, loaderContext, args, callback);\n\t}\n\n\tconvertArgs(args, currentLoaderObject.raw);\n\n\trunSyncOrAsync(fn, loaderContext, args, function(err) {\n\t\tif(err) return callback(err);\n\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\n\t\titerateNormalLoaders(options, loaderContext, args, callback);\n\t});\n}\n\nexports.getContext = function getContext(resource) {\n\tvar splitted = splitQuery(resource);\n\treturn dirname(splitted[0]);\n};\n\nexports.runLoaders = function runLoaders(options, callback) {\n\t// read options\n\tvar resource = options.resource || \"\";\n\tvar loaders = options.loaders || [];\n\tvar loaderContext = options.context || {};\n\tvar readResource = options.readResource || readFile;\n\n\t//\n\tvar splittedResource = resource && splitQuery(resource);\n\tvar resourcePath = splittedResource ? splittedResource[0] : undefined;\n\tvar resourceQuery = splittedResource ? splittedResource[1] : undefined;\n\tvar contextDirectory = resourcePath ? dirname(resourcePath) : null;\n\n\t// execution state\n\tvar requestCacheable = true;\n\tvar fileDependencies = [];\n\tvar contextDependencies = [];\n\n\t// prepare loader objects\n\tloaders = loaders.map(createLoaderObject);\n\n\tloaderContext.context = contextDirectory;\n\tloaderContext.loaderIndex = 0;\n\tloaderContext.loaders = loaders;\n\tloaderContext.resourcePath = resourcePath;\n\tloaderContext.resourceQuery = resourceQuery;\n\tloaderContext.async = null;\n\tloaderContext.callback = null;\n\tloaderContext.cacheable = function cacheable(flag) {\n\t\tif(flag === false) {\n\t\t\trequestCacheable = false;\n\t\t}\n\t};\n\tloaderContext.dependency = loaderContext.addDependency = function addDependency(file) {\n\t\tfileDependencies.push(file);\n\t};\n\tloaderContext.addContextDependency = function addContextDependency(context) {\n\t\tcontextDependencies.push(context);\n\t};\n\tloaderContext.getDependencies = function getDependencies() {\n\t\treturn fileDependencies.slice();\n\t};\n\tloaderContext.getContextDependencies = function getContextDependencies() {\n\t\treturn contextDependencies.slice();\n\t};\n\tloaderContext.clearDependencies = function clearDependencies() {\n\t\tfileDependencies.length = 0;\n\t\tcontextDependencies.length = 0;\n\t\trequestCacheable = true;\n\t};\n\tObject.defineProperty(loaderContext, \"resource\", {\n\t\tenumerable: true,\n\t\tget: function() {\n\t\t\tif(loaderContext.resourcePath === undefined)\n\t\t\t\treturn undefined;\n\t\t\treturn loaderContext.resourcePath + loaderContext.resourceQuery;\n\t\t},\n\t\tset: function(value) {\n\t\t\tvar splittedResource = value && splitQuery(value);\n\t\t\tloaderContext.resourcePath = splittedResource ? splittedResource[0] : undefined;\n\t\t\tloaderContext.resourceQuery = splittedResource ? splittedResource[1] : undefined;\n\t\t}\n\t});\n\tObject.defineProperty(loaderContext, \"request\", {\n\t\tenumerable: true,\n\t\tget: function() {\n\t\t\treturn loaderContext.loaders.map(function(o) {\n\t\t\t\treturn o.request;\n\t\t\t}).concat(loaderContext.resource || \"\").join(\"!\");\n\t\t}\n\t});\n\tObject.defineProperty(loaderContext, \"remainingRequest\", {\n\t\tenumerable: true,\n\t\tget: function() {\n\t\t\tif(loaderContext.loaderIndex >= loaderContext.loaders.length - 1 && !loaderContext.resource)\n\t\t\t\treturn \"\";\n\t\t\treturn loaderContext.loaders.slice(loaderContext.loaderIndex + 1).map(function(o) {\n\t\t\t\treturn o.request;\n\t\t\t}).concat(loaderContext.resource || \"\").join(\"!\");\n\t\t}\n\t});\n\tObject.defineProperty(loaderContext, \"currentRequest\", {\n\t\tenumerable: true,\n\t\tget: function() {\n\t\t\treturn loaderContext.loaders.slice(loaderContext.loaderIndex).map(function(o) {\n\t\t\t\treturn o.request;\n\t\t\t}).concat(loaderContext.resource || \"\").join(\"!\");\n\t\t}\n\t});\n\tObject.defineProperty(loaderContext, \"previousRequest\", {\n\t\tenumerable: true,\n\t\tget: function() {\n\t\t\treturn loaderContext.loaders.slice(0, loaderContext.loaderIndex).map(function(o) {\n\t\t\t\treturn o.request;\n\t\t\t}).join(\"!\");\n\t\t}\n\t});\n\tObject.defineProperty(loaderContext, \"query\", {\n\t\tenumerable: true,\n\t\tget: function() {\n\t\t\tvar entry = loaderContext.loaders[loaderContext.loaderIndex];\n\t\t\treturn entry.options && typeof entry.options === \"object\" ? entry.options : entry.query;\n\t\t}\n\t});\n\tObject.defineProperty(loaderContext, \"data\", {\n\t\tenumerable: true,\n\t\tget: function() {\n\t\t\treturn loaderContext.loaders[loaderContext.loaderIndex].data;\n\t\t}\n\t});\n\n\t// finish loader context\n\tif(Object.preventExtensions) {\n\t\tObject.preventExtensions(loaderContext);\n\t}\n\n\tvar processOptions = {\n\t\tresourceBuffer: null,\n\t\treadResource: readResource\n\t};\n\titeratePitchingLoaders(processOptions, loaderContext, function(err, result) {\n\t\tif(err) {\n\t\t\treturn callback(err, {\n\t\t\t\tcacheable: requestCacheable,\n\t\t\t\tfileDependencies: fileDependencies,\n\t\t\t\tcontextDependencies: contextDependencies\n\t\t\t});\n\t\t}\n\t\tcallback(null, {\n\t\t\tresult: result,\n\t\t\tresourceBuffer: processOptions.resourceBuffer,\n\t\t\tcacheable: requestCacheable,\n\t\t\tfileDependencies: fileDependencies,\n\t\t\tcontextDependencies: contextDependencies\n\t\t});\n\t});\n};\n"]},"metadata":{},"sourceType":"script"}