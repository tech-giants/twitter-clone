{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nvar watcherManager = require(\"./watcherManager\");\n\nvar EventEmitter = require(\"events\").EventEmitter;\n\nfunction Watchpack(options) {\n  EventEmitter.call(this);\n  if (!options) options = {};\n  if (!options.aggregateTimeout) options.aggregateTimeout = 200;\n  this.options = options;\n  this.watcherOptions = {\n    ignored: options.ignored,\n    poll: options.poll\n  };\n  this.fileWatchers = [];\n  this.dirWatchers = [];\n  this.mtimes = Object.create(null);\n  this.paused = false;\n  this.aggregatedChanges = [];\n  this.aggregatedRemovals = [];\n  this.aggregateTimeout = 0;\n  this._onTimeout = this._onTimeout.bind(this);\n}\n\nmodule.exports = Watchpack;\nWatchpack.prototype = Object.create(EventEmitter.prototype);\n\nWatchpack.prototype.watch = function watch(files, directories, startTime) {\n  this.paused = false;\n  var oldFileWatchers = this.fileWatchers;\n  var oldDirWatchers = this.dirWatchers;\n  this.fileWatchers = files.map(function (file) {\n    return this._fileWatcher(file, watcherManager.watchFile(file, this.watcherOptions, startTime));\n  }, this);\n  this.dirWatchers = directories.map(function (dir) {\n    return this._dirWatcher(dir, watcherManager.watchDirectory(dir, this.watcherOptions, startTime));\n  }, this);\n  oldFileWatchers.forEach(function (w) {\n    w.close();\n  }, this);\n  oldDirWatchers.forEach(function (w) {\n    w.close();\n  }, this);\n};\n\nWatchpack.prototype.close = function resume() {\n  this.paused = true;\n  if (this.aggregateTimeout) clearTimeout(this.aggregateTimeout);\n  this.fileWatchers.forEach(function (w) {\n    w.close();\n  }, this);\n  this.dirWatchers.forEach(function (w) {\n    w.close();\n  }, this);\n  this.fileWatchers.length = 0;\n  this.dirWatchers.length = 0;\n};\n\nWatchpack.prototype.pause = function pause() {\n  this.paused = true;\n  if (this.aggregateTimeout) clearTimeout(this.aggregateTimeout);\n};\n\nfunction addWatchersToArray(watchers, array) {\n  watchers.forEach(function (w) {\n    if (array.indexOf(w.directoryWatcher) < 0) {\n      array.push(w.directoryWatcher);\n      addWatchersToArray(Object.keys(w.directoryWatcher.directories).reduce(function (a, dir) {\n        if (w.directoryWatcher.directories[dir] !== true) a.push(w.directoryWatcher.directories[dir]);\n        return a;\n      }, []), array);\n    }\n  });\n}\n\nWatchpack.prototype.getTimes = function () {\n  var directoryWatchers = [];\n  addWatchersToArray(this.fileWatchers.concat(this.dirWatchers), directoryWatchers);\n  var obj = Object.create(null);\n  directoryWatchers.forEach(function (w) {\n    var times = w.getTimes();\n    Object.keys(times).forEach(function (file) {\n      obj[file] = times[file];\n    });\n  });\n  return obj;\n};\n\nWatchpack.prototype._fileWatcher = function _fileWatcher(file, watcher) {\n  watcher.on(\"change\", function (mtime, type) {\n    this._onChange(file, mtime, file, type);\n  }.bind(this));\n  watcher.on(\"remove\", function (type) {\n    this._onRemove(file, file, type);\n  }.bind(this));\n  return watcher;\n};\n\nWatchpack.prototype._dirWatcher = function _dirWatcher(item, watcher) {\n  watcher.on(\"change\", function (file, mtime, type) {\n    this._onChange(item, mtime, file, type);\n  }.bind(this));\n  return watcher;\n};\n\nWatchpack.prototype._onChange = function _onChange(item, mtime, file) {\n  file = file || item;\n  this.mtimes[file] = mtime;\n  if (this.paused) return;\n  this.emit(\"change\", file, mtime);\n  if (this.aggregateTimeout) clearTimeout(this.aggregateTimeout);\n  if (this.aggregatedChanges.indexOf(item) < 0) this.aggregatedChanges.push(item);\n  this.aggregateTimeout = setTimeout(this._onTimeout, this.options.aggregateTimeout);\n};\n\nWatchpack.prototype._onRemove = function _onRemove(item, file) {\n  file = file || item;\n  delete this.mtimes[item];\n  if (this.paused) return;\n  this.emit(\"remove\", item);\n  if (this.aggregateTimeout) clearTimeout(this.aggregateTimeout);\n  if (this.aggregatedRemovals.indexOf(item) < 0) this.aggregatedRemovals.push(item);\n  this.aggregateTimeout = setTimeout(this._onTimeout, this.options.aggregateTimeout);\n};\n\nWatchpack.prototype._onTimeout = function _onTimeout() {\n  this.aggregateTimeout = 0;\n  var changes = this.aggregatedChanges;\n  var removals = this.aggregatedRemovals;\n  this.aggregatedChanges = [];\n  this.aggregatedRemovals = [];\n  this.emit(\"aggregated\", changes, removals);\n};","map":{"version":3,"sources":["/Users/hamzakhan/Documents/twitter-react/twitter/node_modules/watchpack/lib/watchpack.js"],"names":["watcherManager","require","EventEmitter","Watchpack","options","call","aggregateTimeout","watcherOptions","ignored","poll","fileWatchers","dirWatchers","mtimes","Object","create","paused","aggregatedChanges","aggregatedRemovals","_onTimeout","bind","module","exports","prototype","watch","files","directories","startTime","oldFileWatchers","oldDirWatchers","map","file","_fileWatcher","watchFile","dir","_dirWatcher","watchDirectory","forEach","w","close","resume","clearTimeout","length","pause","addWatchersToArray","watchers","array","indexOf","directoryWatcher","push","keys","reduce","a","getTimes","directoryWatchers","concat","obj","times","watcher","on","mtime","type","_onChange","_onRemove","item","emit","setTimeout","changes","removals"],"mappings":"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","sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nvar watcherManager = require(\"./watcherManager\");\nvar EventEmitter = require(\"events\").EventEmitter;\n\nfunction Watchpack(options) {\n\tEventEmitter.call(this);\n\tif(!options) options = {};\n\tif(!options.aggregateTimeout) options.aggregateTimeout = 200;\n\tthis.options = options;\n\tthis.watcherOptions = {\n\t\tignored: options.ignored,\n\t\tpoll: options.poll\n\t};\n\tthis.fileWatchers = [];\n\tthis.dirWatchers = [];\n\tthis.mtimes = Object.create(null);\n\tthis.paused = false;\n\tthis.aggregatedChanges = [];\n\tthis.aggregatedRemovals = [];\n\tthis.aggregateTimeout = 0;\n\tthis._onTimeout = this._onTimeout.bind(this);\n}\n\nmodule.exports = Watchpack;\n\nWatchpack.prototype = Object.create(EventEmitter.prototype);\n\nWatchpack.prototype.watch = function watch(files, directories, startTime) {\n\tthis.paused = false;\n\tvar oldFileWatchers = this.fileWatchers;\n\tvar oldDirWatchers = this.dirWatchers;\n\tthis.fileWatchers = files.map(function(file) {\n\t\treturn this._fileWatcher(file, watcherManager.watchFile(file, this.watcherOptions, startTime));\n\t}, this);\n\tthis.dirWatchers = directories.map(function(dir) {\n\t\treturn this._dirWatcher(dir, watcherManager.watchDirectory(dir, this.watcherOptions, startTime));\n\t}, this);\n\toldFileWatchers.forEach(function(w) {\n\t\tw.close();\n\t}, this);\n\toldDirWatchers.forEach(function(w) {\n\t\tw.close();\n\t}, this);\n};\n\nWatchpack.prototype.close = function resume() {\n\tthis.paused = true;\n\tif(this.aggregateTimeout)\n\t\tclearTimeout(this.aggregateTimeout);\n\tthis.fileWatchers.forEach(function(w) {\n\t\tw.close();\n\t}, this);\n\tthis.dirWatchers.forEach(function(w) {\n\t\tw.close();\n\t}, this);\n\tthis.fileWatchers.length = 0;\n\tthis.dirWatchers.length = 0;\n};\n\nWatchpack.prototype.pause = function pause() {\n\tthis.paused = true;\n\tif(this.aggregateTimeout)\n\t\tclearTimeout(this.aggregateTimeout);\n};\n\nfunction addWatchersToArray(watchers, array) {\n\twatchers.forEach(function(w) {\n\t\tif(array.indexOf(w.directoryWatcher) < 0) {\n\t\t\tarray.push(w.directoryWatcher);\n\t\t\taddWatchersToArray(Object.keys(w.directoryWatcher.directories).reduce(function(a, dir) {\n\t\t\t\tif(w.directoryWatcher.directories[dir] !== true)\n\t\t\t\t\ta.push(w.directoryWatcher.directories[dir]);\n\t\t\t\treturn a;\n\t\t\t}, []), array);\n\t\t}\n\t});\n}\n\nWatchpack.prototype.getTimes = function() {\n\tvar directoryWatchers = [];\n\taddWatchersToArray(this.fileWatchers.concat(this.dirWatchers), directoryWatchers);\n\tvar obj = Object.create(null);\n\tdirectoryWatchers.forEach(function(w) {\n\t\tvar times = w.getTimes();\n\t\tObject.keys(times).forEach(function(file) {\n\t\t\tobj[file] = times[file];\n\t\t});\n\t});\n\treturn obj;\n};\n\nWatchpack.prototype._fileWatcher = function _fileWatcher(file, watcher) {\n\twatcher.on(\"change\", function(mtime, type) {\n\t\tthis._onChange(file, mtime, file, type);\n\t}.bind(this));\n\twatcher.on(\"remove\", function(type) {\n\t\tthis._onRemove(file, file, type);\n\t}.bind(this));\n\treturn watcher;\n};\n\nWatchpack.prototype._dirWatcher = function _dirWatcher(item, watcher) {\n\twatcher.on(\"change\", function(file, mtime, type) {\n\t\tthis._onChange(item, mtime, file, type);\n\t}.bind(this));\n\treturn watcher;\n};\n\nWatchpack.prototype._onChange = function _onChange(item, mtime, file) {\n\tfile = file || item;\n\tthis.mtimes[file] = mtime;\n\tif(this.paused) return;\n\tthis.emit(\"change\", file, mtime);\n\tif(this.aggregateTimeout)\n\t\tclearTimeout(this.aggregateTimeout);\n\tif(this.aggregatedChanges.indexOf(item) < 0)\n\t\tthis.aggregatedChanges.push(item);\n\tthis.aggregateTimeout = setTimeout(this._onTimeout, this.options.aggregateTimeout);\n};\n\nWatchpack.prototype._onRemove = function _onRemove(item, file) {\n\tfile = file || item;\n\tdelete this.mtimes[item];\n\tif(this.paused) return;\n\tthis.emit(\"remove\", item);\n\tif(this.aggregateTimeout)\n\t\tclearTimeout(this.aggregateTimeout);\n\tif(this.aggregatedRemovals.indexOf(item) < 0)\n\t\tthis.aggregatedRemovals.push(item);\n\tthis.aggregateTimeout = setTimeout(this._onTimeout, this.options.aggregateTimeout);\n};\n\nWatchpack.prototype._onTimeout = function _onTimeout() {\n\tthis.aggregateTimeout = 0;\n\tvar changes = this.aggregatedChanges;\n\tvar removals = this.aggregatedRemovals;\n\tthis.aggregatedChanges = [];\n\tthis.aggregatedRemovals = [];\n\tthis.emit(\"aggregated\", changes, removals);\n};\n"]},"metadata":{},"sourceType":"script"}