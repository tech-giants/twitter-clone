{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst path = require(\"path\");\n\nconst ContextElementDependency = require(\"./dependencies/ContextElementDependency\");\n\nclass ContextReplacementPlugin {\n  constructor(resourceRegExp, newContentResource, newContentRecursive, newContentRegExp) {\n    this.resourceRegExp = resourceRegExp;\n\n    if (typeof newContentResource === \"function\") {\n      this.newContentCallback = newContentResource;\n    } else if (typeof newContentResource === \"string\" && typeof newContentRecursive === \"object\") {\n      this.newContentResource = newContentResource;\n\n      this.newContentCreateContextMap = (fs, callback) => {\n        callback(null, newContentRecursive);\n      };\n    } else if (typeof newContentResource === \"string\" && typeof newContentRecursive === \"function\") {\n      this.newContentResource = newContentResource;\n      this.newContentCreateContextMap = newContentRecursive;\n    } else {\n      if (typeof newContentResource !== \"string\") {\n        newContentRegExp = newContentRecursive;\n        newContentRecursive = newContentResource;\n        newContentResource = undefined;\n      }\n\n      if (typeof newContentRecursive !== \"boolean\") {\n        newContentRegExp = newContentRecursive;\n        newContentRecursive = undefined;\n      }\n\n      this.newContentResource = newContentResource;\n      this.newContentRecursive = newContentRecursive;\n      this.newContentRegExp = newContentRegExp;\n    }\n  }\n\n  apply(compiler) {\n    const resourceRegExp = this.resourceRegExp;\n    const newContentCallback = this.newContentCallback;\n    const newContentResource = this.newContentResource;\n    const newContentRecursive = this.newContentRecursive;\n    const newContentRegExp = this.newContentRegExp;\n    const newContentCreateContextMap = this.newContentCreateContextMap;\n    compiler.hooks.contextModuleFactory.tap(\"ContextReplacementPlugin\", cmf => {\n      cmf.hooks.beforeResolve.tap(\"ContextReplacementPlugin\", result => {\n        if (!result) return;\n\n        if (resourceRegExp.test(result.request)) {\n          if (newContentResource !== undefined) {\n            result.request = newContentResource;\n          }\n\n          if (newContentRecursive !== undefined) {\n            result.recursive = newContentRecursive;\n          }\n\n          if (newContentRegExp !== undefined) {\n            result.regExp = newContentRegExp;\n          }\n\n          if (typeof newContentCallback === \"function\") {\n            newContentCallback(result);\n          } else {\n            for (const d of result.dependencies) {\n              if (d.critical) d.critical = false;\n            }\n          }\n        }\n\n        return result;\n      });\n      cmf.hooks.afterResolve.tap(\"ContextReplacementPlugin\", result => {\n        if (!result) return;\n\n        if (resourceRegExp.test(result.resource)) {\n          if (newContentResource !== undefined) {\n            result.resource = path.resolve(result.resource, newContentResource);\n          }\n\n          if (newContentRecursive !== undefined) {\n            result.recursive = newContentRecursive;\n          }\n\n          if (newContentRegExp !== undefined) {\n            result.regExp = newContentRegExp;\n          }\n\n          if (typeof newContentCreateContextMap === \"function\") {\n            result.resolveDependencies = createResolveDependenciesFromContextMap(newContentCreateContextMap);\n          }\n\n          if (typeof newContentCallback === \"function\") {\n            const origResource = result.resource;\n            newContentCallback(result);\n\n            if (result.resource !== origResource) {\n              result.resource = path.resolve(origResource, result.resource);\n            }\n          } else {\n            for (const d of result.dependencies) {\n              if (d.critical) d.critical = false;\n            }\n          }\n        }\n\n        return result;\n      });\n    });\n  }\n\n}\n\nconst createResolveDependenciesFromContextMap = createContextMap => {\n  const resolveDependenciesFromContextMap = (fs, options, callback) => {\n    createContextMap(fs, (err, map) => {\n      if (err) return callback(err);\n      const dependencies = Object.keys(map).map(key => {\n        return new ContextElementDependency(map[key] + options.resourceQuery, key);\n      });\n      callback(null, dependencies);\n    });\n  };\n\n  return resolveDependenciesFromContextMap;\n};\n\nmodule.exports = ContextReplacementPlugin;","map":{"version":3,"sources":["/Users/hamzakhan/Documents/twitter-react/twitter/node_modules/webpack/lib/ContextReplacementPlugin.js"],"names":["path","require","ContextElementDependency","ContextReplacementPlugin","constructor","resourceRegExp","newContentResource","newContentRecursive","newContentRegExp","newContentCallback","newContentCreateContextMap","fs","callback","undefined","apply","compiler","hooks","contextModuleFactory","tap","cmf","beforeResolve","result","test","request","recursive","regExp","d","dependencies","critical","afterResolve","resource","resolve","resolveDependencies","createResolveDependenciesFromContextMap","origResource","createContextMap","resolveDependenciesFromContextMap","options","err","map","Object","keys","key","resourceQuery","module","exports"],"mappings":"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","sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst path = require(\"path\");\nconst ContextElementDependency = require(\"./dependencies/ContextElementDependency\");\n\nclass ContextReplacementPlugin {\n\tconstructor(\n\t\tresourceRegExp,\n\t\tnewContentResource,\n\t\tnewContentRecursive,\n\t\tnewContentRegExp\n\t) {\n\t\tthis.resourceRegExp = resourceRegExp;\n\n\t\tif (typeof newContentResource === \"function\") {\n\t\t\tthis.newContentCallback = newContentResource;\n\t\t} else if (\n\t\t\ttypeof newContentResource === \"string\" &&\n\t\t\ttypeof newContentRecursive === \"object\"\n\t\t) {\n\t\t\tthis.newContentResource = newContentResource;\n\t\t\tthis.newContentCreateContextMap = (fs, callback) => {\n\t\t\t\tcallback(null, newContentRecursive);\n\t\t\t};\n\t\t} else if (\n\t\t\ttypeof newContentResource === \"string\" &&\n\t\t\ttypeof newContentRecursive === \"function\"\n\t\t) {\n\t\t\tthis.newContentResource = newContentResource;\n\t\t\tthis.newContentCreateContextMap = newContentRecursive;\n\t\t} else {\n\t\t\tif (typeof newContentResource !== \"string\") {\n\t\t\t\tnewContentRegExp = newContentRecursive;\n\t\t\t\tnewContentRecursive = newContentResource;\n\t\t\t\tnewContentResource = undefined;\n\t\t\t}\n\t\t\tif (typeof newContentRecursive !== \"boolean\") {\n\t\t\t\tnewContentRegExp = newContentRecursive;\n\t\t\t\tnewContentRecursive = undefined;\n\t\t\t}\n\t\t\tthis.newContentResource = newContentResource;\n\t\t\tthis.newContentRecursive = newContentRecursive;\n\t\t\tthis.newContentRegExp = newContentRegExp;\n\t\t}\n\t}\n\n\tapply(compiler) {\n\t\tconst resourceRegExp = this.resourceRegExp;\n\t\tconst newContentCallback = this.newContentCallback;\n\t\tconst newContentResource = this.newContentResource;\n\t\tconst newContentRecursive = this.newContentRecursive;\n\t\tconst newContentRegExp = this.newContentRegExp;\n\t\tconst newContentCreateContextMap = this.newContentCreateContextMap;\n\n\t\tcompiler.hooks.contextModuleFactory.tap(\"ContextReplacementPlugin\", cmf => {\n\t\t\tcmf.hooks.beforeResolve.tap(\"ContextReplacementPlugin\", result => {\n\t\t\t\tif (!result) return;\n\t\t\t\tif (resourceRegExp.test(result.request)) {\n\t\t\t\t\tif (newContentResource !== undefined) {\n\t\t\t\t\t\tresult.request = newContentResource;\n\t\t\t\t\t}\n\t\t\t\t\tif (newContentRecursive !== undefined) {\n\t\t\t\t\t\tresult.recursive = newContentRecursive;\n\t\t\t\t\t}\n\t\t\t\t\tif (newContentRegExp !== undefined) {\n\t\t\t\t\t\tresult.regExp = newContentRegExp;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof newContentCallback === \"function\") {\n\t\t\t\t\t\tnewContentCallback(result);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (const d of result.dependencies) {\n\t\t\t\t\t\t\tif (d.critical) d.critical = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t});\n\t\t\tcmf.hooks.afterResolve.tap(\"ContextReplacementPlugin\", result => {\n\t\t\t\tif (!result) return;\n\t\t\t\tif (resourceRegExp.test(result.resource)) {\n\t\t\t\t\tif (newContentResource !== undefined) {\n\t\t\t\t\t\tresult.resource = path.resolve(result.resource, newContentResource);\n\t\t\t\t\t}\n\t\t\t\t\tif (newContentRecursive !== undefined) {\n\t\t\t\t\t\tresult.recursive = newContentRecursive;\n\t\t\t\t\t}\n\t\t\t\t\tif (newContentRegExp !== undefined) {\n\t\t\t\t\t\tresult.regExp = newContentRegExp;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof newContentCreateContextMap === \"function\") {\n\t\t\t\t\t\tresult.resolveDependencies = createResolveDependenciesFromContextMap(\n\t\t\t\t\t\t\tnewContentCreateContextMap\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof newContentCallback === \"function\") {\n\t\t\t\t\t\tconst origResource = result.resource;\n\t\t\t\t\t\tnewContentCallback(result);\n\t\t\t\t\t\tif (result.resource !== origResource) {\n\t\t\t\t\t\t\tresult.resource = path.resolve(origResource, result.resource);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (const d of result.dependencies) {\n\t\t\t\t\t\t\tif (d.critical) d.critical = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t});\n\t\t});\n\t}\n}\n\nconst createResolveDependenciesFromContextMap = createContextMap => {\n\tconst resolveDependenciesFromContextMap = (fs, options, callback) => {\n\t\tcreateContextMap(fs, (err, map) => {\n\t\t\tif (err) return callback(err);\n\t\t\tconst dependencies = Object.keys(map).map(key => {\n\t\t\t\treturn new ContextElementDependency(\n\t\t\t\t\tmap[key] + options.resourceQuery,\n\t\t\t\t\tkey\n\t\t\t\t);\n\t\t\t});\n\t\t\tcallback(null, dependencies);\n\t\t});\n\t};\n\treturn resolveDependenciesFromContextMap;\n};\n\nmodule.exports = ContextReplacementPlugin;\n"]},"metadata":{},"sourceType":"script"}