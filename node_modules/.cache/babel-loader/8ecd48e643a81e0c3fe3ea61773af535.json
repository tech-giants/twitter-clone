{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst Watchpack = require(\"watchpack\");\n\nconst objectToMap = require(\"../util/objectToMap\");\n\nclass NodeWatchFileSystem {\n  constructor(inputFileSystem) {\n    this.inputFileSystem = inputFileSystem;\n    this.watcherOptions = {\n      aggregateTimeout: 0\n    };\n    this.watcher = new Watchpack(this.watcherOptions);\n  }\n\n  watch(files, dirs, missing, startTime, options, callback, callbackUndelayed) {\n    if (!Array.isArray(files)) {\n      throw new Error(\"Invalid arguments: 'files'\");\n    }\n\n    if (!Array.isArray(dirs)) {\n      throw new Error(\"Invalid arguments: 'dirs'\");\n    }\n\n    if (!Array.isArray(missing)) {\n      throw new Error(\"Invalid arguments: 'missing'\");\n    }\n\n    if (typeof callback !== \"function\") {\n      throw new Error(\"Invalid arguments: 'callback'\");\n    }\n\n    if (typeof startTime !== \"number\" && startTime) {\n      throw new Error(\"Invalid arguments: 'startTime'\");\n    }\n\n    if (typeof options !== \"object\") {\n      throw new Error(\"Invalid arguments: 'options'\");\n    }\n\n    if (typeof callbackUndelayed !== \"function\" && callbackUndelayed) {\n      throw new Error(\"Invalid arguments: 'callbackUndelayed'\");\n    }\n\n    const oldWatcher = this.watcher;\n    this.watcher = new Watchpack(options);\n\n    if (callbackUndelayed) {\n      this.watcher.once(\"change\", callbackUndelayed);\n    }\n\n    const cachedFiles = files;\n    const cachedDirs = dirs;\n    this.watcher.once(\"aggregated\", (changes, removals) => {\n      changes = changes.concat(removals);\n\n      if (this.inputFileSystem && this.inputFileSystem.purge) {\n        this.inputFileSystem.purge(changes);\n      }\n\n      const times = objectToMap(this.watcher.getTimes());\n      files = new Set(files);\n      dirs = new Set(dirs);\n      missing = new Set(missing);\n      removals = new Set(removals.filter(file => files.has(file)));\n      callback(null, changes.filter(file => files.has(file)).sort(), changes.filter(file => dirs.has(file)).sort(), changes.filter(file => missing.has(file)).sort(), times, times, removals);\n    });\n    this.watcher.watch(cachedFiles.concat(missing), cachedDirs.concat(missing), startTime);\n\n    if (oldWatcher) {\n      oldWatcher.close();\n    }\n\n    return {\n      close: () => {\n        if (this.watcher) {\n          this.watcher.close();\n          this.watcher = null;\n        }\n      },\n      pause: () => {\n        if (this.watcher) {\n          this.watcher.pause();\n        }\n      },\n      getFileTimestamps: () => {\n        if (this.watcher) {\n          return objectToMap(this.watcher.getTimes());\n        } else {\n          return new Map();\n        }\n      },\n      getContextTimestamps: () => {\n        if (this.watcher) {\n          return objectToMap(this.watcher.getTimes());\n        } else {\n          return new Map();\n        }\n      }\n    };\n  }\n\n}\n\nmodule.exports = NodeWatchFileSystem;","map":{"version":3,"sources":["/Users/hamzakhan/Documents/twitter-react/twitter/node_modules/webpack/lib/node/NodeWatchFileSystem.js"],"names":["Watchpack","require","objectToMap","NodeWatchFileSystem","constructor","inputFileSystem","watcherOptions","aggregateTimeout","watcher","watch","files","dirs","missing","startTime","options","callback","callbackUndelayed","Array","isArray","Error","oldWatcher","once","cachedFiles","cachedDirs","changes","removals","concat","purge","times","getTimes","Set","filter","file","has","sort","close","pause","getFileTimestamps","Map","getContextTimestamps","module","exports"],"mappings":"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","sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst Watchpack = require(\"watchpack\");\nconst objectToMap = require(\"../util/objectToMap\");\n\nclass NodeWatchFileSystem {\n\tconstructor(inputFileSystem) {\n\t\tthis.inputFileSystem = inputFileSystem;\n\t\tthis.watcherOptions = {\n\t\t\taggregateTimeout: 0\n\t\t};\n\t\tthis.watcher = new Watchpack(this.watcherOptions);\n\t}\n\n\twatch(files, dirs, missing, startTime, options, callback, callbackUndelayed) {\n\t\tif (!Array.isArray(files)) {\n\t\t\tthrow new Error(\"Invalid arguments: 'files'\");\n\t\t}\n\t\tif (!Array.isArray(dirs)) {\n\t\t\tthrow new Error(\"Invalid arguments: 'dirs'\");\n\t\t}\n\t\tif (!Array.isArray(missing)) {\n\t\t\tthrow new Error(\"Invalid arguments: 'missing'\");\n\t\t}\n\t\tif (typeof callback !== \"function\") {\n\t\t\tthrow new Error(\"Invalid arguments: 'callback'\");\n\t\t}\n\t\tif (typeof startTime !== \"number\" && startTime) {\n\t\t\tthrow new Error(\"Invalid arguments: 'startTime'\");\n\t\t}\n\t\tif (typeof options !== \"object\") {\n\t\t\tthrow new Error(\"Invalid arguments: 'options'\");\n\t\t}\n\t\tif (typeof callbackUndelayed !== \"function\" && callbackUndelayed) {\n\t\t\tthrow new Error(\"Invalid arguments: 'callbackUndelayed'\");\n\t\t}\n\t\tconst oldWatcher = this.watcher;\n\t\tthis.watcher = new Watchpack(options);\n\n\t\tif (callbackUndelayed) {\n\t\t\tthis.watcher.once(\"change\", callbackUndelayed);\n\t\t}\n\t\tconst cachedFiles = files;\n\t\tconst cachedDirs = dirs;\n\t\tthis.watcher.once(\"aggregated\", (changes, removals) => {\n\t\t\tchanges = changes.concat(removals);\n\t\t\tif (this.inputFileSystem && this.inputFileSystem.purge) {\n\t\t\t\tthis.inputFileSystem.purge(changes);\n\t\t\t}\n\t\t\tconst times = objectToMap(this.watcher.getTimes());\n\t\t\tfiles = new Set(files);\n\t\t\tdirs = new Set(dirs);\n\t\t\tmissing = new Set(missing);\n\t\t\tremovals = new Set(removals.filter(file => files.has(file)));\n\t\t\tcallback(\n\t\t\t\tnull,\n\t\t\t\tchanges.filter(file => files.has(file)).sort(),\n\t\t\t\tchanges.filter(file => dirs.has(file)).sort(),\n\t\t\t\tchanges.filter(file => missing.has(file)).sort(),\n\t\t\t\ttimes,\n\t\t\t\ttimes,\n\t\t\t\tremovals\n\t\t\t);\n\t\t});\n\n\t\tthis.watcher.watch(\n\t\t\tcachedFiles.concat(missing),\n\t\t\tcachedDirs.concat(missing),\n\t\t\tstartTime\n\t\t);\n\n\t\tif (oldWatcher) {\n\t\t\toldWatcher.close();\n\t\t}\n\t\treturn {\n\t\t\tclose: () => {\n\t\t\t\tif (this.watcher) {\n\t\t\t\t\tthis.watcher.close();\n\t\t\t\t\tthis.watcher = null;\n\t\t\t\t}\n\t\t\t},\n\t\t\tpause: () => {\n\t\t\t\tif (this.watcher) {\n\t\t\t\t\tthis.watcher.pause();\n\t\t\t\t}\n\t\t\t},\n\t\t\tgetFileTimestamps: () => {\n\t\t\t\tif (this.watcher) {\n\t\t\t\t\treturn objectToMap(this.watcher.getTimes());\n\t\t\t\t} else {\n\t\t\t\t\treturn new Map();\n\t\t\t\t}\n\t\t\t},\n\t\t\tgetContextTimestamps: () => {\n\t\t\t\tif (this.watcher) {\n\t\t\t\t\treturn objectToMap(this.watcher.getTimes());\n\t\t\t\t} else {\n\t\t\t\t\treturn new Map();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n}\n\nmodule.exports = NodeWatchFileSystem;\n"]},"metadata":{},"sourceType":"script"}