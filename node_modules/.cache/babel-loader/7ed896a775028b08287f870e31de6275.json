{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst LoaderDependency = require(\"./LoaderDependency\");\n\nconst NormalModule = require(\"../NormalModule\");\n/** @typedef {import(\"../Module\")} Module */\n\n/**\n * @callback LoadModuleCallback\n * @param {Error=} err error object\n * @param {string=} source source code\n * @param {object=} map source map\n * @param {Module=} module loaded module if successful\n */\n\n\nclass LoaderPlugin {\n  apply(compiler) {\n    compiler.hooks.compilation.tap(\"LoaderPlugin\", (compilation, {\n      normalModuleFactory\n    }) => {\n      compilation.dependencyFactories.set(LoaderDependency, normalModuleFactory);\n    });\n    compiler.hooks.compilation.tap(\"LoaderPlugin\", compilation => {\n      compilation.hooks.normalModuleLoader.tap(\"LoaderPlugin\", (loaderContext, module) => {\n        /**\n         * @param {string} request the request string to load the module from\n         * @param {LoadModuleCallback} callback callback returning the loaded module or error\n         * @returns {void}\n         */\n        loaderContext.loadModule = (request, callback) => {\n          const dep = new LoaderDependency(request);\n          dep.loc = {\n            name: request\n          };\n          const factory = compilation.dependencyFactories.get(dep.constructor);\n\n          if (factory === undefined) {\n            return callback(new Error(`No module factory available for dependency type: ${dep.constructor.name}`));\n          }\n\n          compilation.semaphore.release();\n          compilation.addModuleDependencies(module, [{\n            factory,\n            dependencies: [dep]\n          }], true, \"lm\", true, err => {\n            compilation.semaphore.acquire(() => {\n              if (err) {\n                return callback(err);\n              }\n\n              if (!dep.module) {\n                return callback(new Error(\"Cannot load the module\"));\n              } // TODO consider removing this in webpack 5\n\n\n              if (dep.module instanceof NormalModule && dep.module.error) {\n                return callback(dep.module.error);\n              }\n\n              if (!dep.module._source) {\n                throw new Error(\"The module created for a LoaderDependency must have a property _source\");\n              }\n\n              let source, map;\n              const moduleSource = dep.module._source;\n\n              if (moduleSource.sourceAndMap) {\n                const sourceAndMap = moduleSource.sourceAndMap();\n                map = sourceAndMap.map;\n                source = sourceAndMap.source;\n              } else {\n                map = moduleSource.map();\n                source = moduleSource.source();\n              }\n\n              if (dep.module.buildInfo.fileDependencies) {\n                for (const d of dep.module.buildInfo.fileDependencies) {\n                  loaderContext.addDependency(d);\n                }\n              }\n\n              if (dep.module.buildInfo.contextDependencies) {\n                for (const d of dep.module.buildInfo.contextDependencies) {\n                  loaderContext.addContextDependency(d);\n                }\n              }\n\n              return callback(null, source, map, dep.module);\n            });\n          });\n        };\n      });\n    });\n  }\n\n}\n\nmodule.exports = LoaderPlugin;","map":{"version":3,"sources":["/Users/hamzakhan/Documents/twitter-react/twitter/node_modules/webpack/lib/dependencies/LoaderPlugin.js"],"names":["LoaderDependency","require","NormalModule","LoaderPlugin","apply","compiler","hooks","compilation","tap","normalModuleFactory","dependencyFactories","set","normalModuleLoader","loaderContext","module","loadModule","request","callback","dep","loc","name","factory","get","constructor","undefined","Error","semaphore","release","addModuleDependencies","dependencies","err","acquire","error","_source","source","map","moduleSource","sourceAndMap","buildInfo","fileDependencies","d","addDependency","contextDependencies","addContextDependency","exports"],"mappings":"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","sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst LoaderDependency = require(\"./LoaderDependency\");\nconst NormalModule = require(\"../NormalModule\");\n\n/** @typedef {import(\"../Module\")} Module */\n\n/**\n * @callback LoadModuleCallback\n * @param {Error=} err error object\n * @param {string=} source source code\n * @param {object=} map source map\n * @param {Module=} module loaded module if successful\n */\n\nclass LoaderPlugin {\n\tapply(compiler) {\n\t\tcompiler.hooks.compilation.tap(\n\t\t\t\"LoaderPlugin\",\n\t\t\t(compilation, { normalModuleFactory }) => {\n\t\t\t\tcompilation.dependencyFactories.set(\n\t\t\t\t\tLoaderDependency,\n\t\t\t\t\tnormalModuleFactory\n\t\t\t\t);\n\t\t\t}\n\t\t);\n\n\t\tcompiler.hooks.compilation.tap(\"LoaderPlugin\", compilation => {\n\t\t\tcompilation.hooks.normalModuleLoader.tap(\n\t\t\t\t\"LoaderPlugin\",\n\t\t\t\t(loaderContext, module) => {\n\t\t\t\t\t/**\n\t\t\t\t\t * @param {string} request the request string to load the module from\n\t\t\t\t\t * @param {LoadModuleCallback} callback callback returning the loaded module or error\n\t\t\t\t\t * @returns {void}\n\t\t\t\t\t */\n\t\t\t\t\tloaderContext.loadModule = (request, callback) => {\n\t\t\t\t\t\tconst dep = new LoaderDependency(request);\n\t\t\t\t\t\tdep.loc = {\n\t\t\t\t\t\t\tname: request\n\t\t\t\t\t\t};\n\t\t\t\t\t\tconst factory = compilation.dependencyFactories.get(\n\t\t\t\t\t\t\tdep.constructor\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (factory === undefined) {\n\t\t\t\t\t\t\treturn callback(\n\t\t\t\t\t\t\t\tnew Error(\n\t\t\t\t\t\t\t\t\t`No module factory available for dependency type: ${dep.constructor.name}`\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcompilation.semaphore.release();\n\t\t\t\t\t\tcompilation.addModuleDependencies(\n\t\t\t\t\t\t\tmodule,\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfactory,\n\t\t\t\t\t\t\t\t\tdependencies: [dep]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t\"lm\",\n\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\terr => {\n\t\t\t\t\t\t\t\tcompilation.semaphore.acquire(() => {\n\t\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\t\treturn callback(err);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (!dep.module) {\n\t\t\t\t\t\t\t\t\t\treturn callback(new Error(\"Cannot load the module\"));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t// TODO consider removing this in webpack 5\n\t\t\t\t\t\t\t\t\tif (dep.module instanceof NormalModule && dep.module.error) {\n\t\t\t\t\t\t\t\t\t\treturn callback(dep.module.error);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (!dep.module._source) {\n\t\t\t\t\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t\t\t\t\t\"The module created for a LoaderDependency must have a property _source\"\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tlet source, map;\n\t\t\t\t\t\t\t\t\tconst moduleSource = dep.module._source;\n\t\t\t\t\t\t\t\t\tif (moduleSource.sourceAndMap) {\n\t\t\t\t\t\t\t\t\t\tconst sourceAndMap = moduleSource.sourceAndMap();\n\t\t\t\t\t\t\t\t\t\tmap = sourceAndMap.map;\n\t\t\t\t\t\t\t\t\t\tsource = sourceAndMap.source;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tmap = moduleSource.map();\n\t\t\t\t\t\t\t\t\t\tsource = moduleSource.source();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (dep.module.buildInfo.fileDependencies) {\n\t\t\t\t\t\t\t\t\t\tfor (const d of dep.module.buildInfo.fileDependencies) {\n\t\t\t\t\t\t\t\t\t\t\tloaderContext.addDependency(d);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (dep.module.buildInfo.contextDependencies) {\n\t\t\t\t\t\t\t\t\t\tfor (const d of dep.module.buildInfo.contextDependencies) {\n\t\t\t\t\t\t\t\t\t\t\tloaderContext.addContextDependency(d);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn callback(null, source, map, dep.module);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n}\nmodule.exports = LoaderPlugin;\n"]},"metadata":{},"sourceType":"script"}